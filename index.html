<!DOCTYPE html> 
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🧬彥彬 健康自檢表</title>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <!-- jQuery for JSONP -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36D399',
            accent: '#FF7D00',
            warning: '#FF5630',
            neutral: '#F5F7FA',
            'neutral-dark': '#333F51'
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .card-hover {
        transition: all 0.3s ease;
      }
      .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(22, 93, 255, 0.1), 0 10px 10px -5px rgba(22, 93, 255, 0.04);
      }
      .error-input {
        border-color: #FF5630 !important;
      }
      .error-message {
        color: #FF5630;
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }
    }
  </style>
</head>

<body class="font-inter bg-neutral text-neutral-dark min-h-screen">
  <!-- 導航欄 -->
  <header class="sticky top-0 z-50 bg-white/95 shadow-sm backdrop-blur-sm transition-all duration-300">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <i class="fa fa-heartbeat text-primary text-2xl"></i>
        <h1 class="text-xl md:text-2xl font-bold text-primary">彥彬 健康自檢表</h1>
      </div>
      <nav class="hidden md:flex items-center space-x-6">
        <a href="#intro" class="text-neutral-dark/80 hover:text-primary transition-colors">簡介</a>
        <a href="#form" class="text-neutral-dark/80 hover:text-primary transition-colors">開始評估</a>
        <a href="#guide" class="text-neutral-dark/80 hover:text-primary transition-colors">填寫指南</a>
        <a href="#result" class="text-neutral-dark/80 hover:text-primary transition-colors">結果解讀</a>
      </nav>
      <button class="md:hidden text-neutral-dark text-xl" id="menuToggle">
        <i class="fa fa-bars"></i>
      </button>
    </div>
    <!-- 移動端菜單 -->
    <div id="mobileMenu" class="hidden md:hidden bg-white border-t">
      <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
        <a href="#intro" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">簡介</a>
        <a href="#form" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">開始評估</a>
        <a href="#guide" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">填寫指南</a>
        <a href="#result" class="py-2 text-neutral-dark/80 hover:text-primary transition-colors">結果解讀</a>
      </div>
    </div>
  </header>

  <!-- 英雄區域 -->
  <section class="bg-gradient-to-br from-primary/90 to-primary text-white py-12 md:py-20">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-[clamp(1.8rem,5vw,3rem)] font-bold mb-4 text-shadow leading-tight">
          瞭解您的身體信號
        </h2>
        <p class="text-lg md:text-xl opacity-90 mb-8">
          通過科學的自檢表，發現健康隱患，<br>掌握身體狀況，邁向更健康的生活 </p>
        </p>
        <a href="#form" class="inline-block bg-white text-primary font-semibold px-6 py-3 rounded-full shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">
          開始我的健康評估 <i class="fa fa-arrow-right ml-2"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- 簡介部分 -->
  <section id="intro" class="py-12 md:py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-6 text-center">為什麼需要健康自檢？</h2>
        <p class="text-lg mb-8 text-neutral-dark/80 leading-relaxed">
          許多健康問題在早期並沒有明顯症狀，等到出現明顯不適時往往已經發展到較嚴重的階段。定期進行健康自檢，
          可以幫助您及時發現身體發出的預警信號，採取相應措施，防患於未然。
        </p>
        
        <div class="grid md:grid-cols-3 gap-6 mb-8">
          <div class="bg-neutral p-6 rounded-xl text-center card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fa fa-stethoscope text-primary text-2xl"></i>
            </div>
            <h3 class="font-semibold text-lg mb-2">早期發現</h3>
            <p class="text-neutral-dark/70">及時捕捉身體異常信號，<br>早發現潛在健康風險</p>
          </div>
          
          <div class="bg-neutral p-6 rounded-xl text-center card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fa fa-line-chart text-primary text-2xl"></i>
            </div>
            <h3 class="font-semibold text-lg mb-2">跟蹤變化</h3>
            <p class="text-neutral-dark/70">記錄健康數據變化，掌握身體狀況發展趨勢</p>
          </div>
          
          <div class="bg-neutral p-6 rounded-xl text-center card-hover">
            <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fa fa-medkit text-primary text-2xl"></i>
            </div>
            <h3 class="font-semibold text-lg mb-2">科學調理</h3>
            <p class="text-neutral-dark/70">為健康調理提供依據，實現個性化健康管理</p>
          </div>
        </div>
        
        <div class="bg-primary/5 border-l-4 border-primary p-5 rounded-r-lg">
          <p class="italic text-neutral-dark/80">
            <i class="fa fa-info-circle text-primary mr-2"></i> 
            本表僅作為健康參考，不能替代專業醫療診斷。如有嚴重不適，請及時咨詢醫生。
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- 進度指示器 -->
  <section id="form" class="py-12 bg-neutral">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">健康自檢表單</h2>
        
        <!-- 步驟指示器 -->
        <div class="mb-10">
          <div class="flex items-center justify-between">
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold mb-2">1</div>
              <span class="text-sm md:text-base text-center">基本信息</span>
            </div>
            <div class="flex-1 max-w-[80px] h-1 bg-gray-200 mx-2">
              <div class="step-progress h-full bg-primary" style="width: 0%"></div>
            </div>
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-2">2</div>
              <span class="text-sm md:text-base text-center">身體症狀</span>
            </div>
            <div class="flex-1 max-w-[80px] h-1 bg-gray-200 mx-2">
              <div class="step-progress h-full bg-primary" style="width: 0%"></div>
            </div>
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-2">3</div>
              <span class="text-sm md:text-base text-center">生活習慣</span>
            </div>
            <div class="flex-1 max-w-[80px] h-1 bg-gray-200 mx-2">
              <div class="step-progress h-full bg-primary" style="width: 0%"></div>
            </div>
            <div class="flex flex-col items-center w-full">
              <div class="step-indicator w-10 h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold mb-2">4</div>
              <span class="text-sm md:text-base text-center">健康評估</span>
            </div>
          </div>
        </div>
        
        <!-- 表單容器 -->
<div class="bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
  <!-- 步驟1: 基本信息 -->
  <div class="form-step active" id="step1">
    <h3 class="text-xl font-semibold mb-6 pb-2 border-b">基本信息</h3>
    
    <div class="grid md:grid-cols-2 gap-6 mb-6">

      <div>
        <label for="lineUserId" class="block text-sm font-medium text-neutral-dark/80 mb-1">Line 用戶ID</label>
        <input type="text" id="lineUserId" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="Line用戶ID">
      </div>

      <div>
        <label for="lineUserName" class="block text-sm font-medium text-neutral-dark/80 mb-1">Line 用戶名稱</label>
        <input type="text" id="lineUserName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="Line用戶名稱">
      </div>

      <div>
        <label for="name" class="block text-sm font-medium text-neutral-dark/80 mb-1">姓名 <span class="text-warning">*</span></label>
        <input type="text" id="name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的姓名">
        <div class="error-message hidden" id="nameError">請輸入您的姓名</div>
      </div>
      
      <div>
        <label for="age" class="block text-sm font-medium text-neutral-dark/80 mb-1">年齡 <span class="text-warning">*</span></label>
        <input type="number" id="age" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的年齡">
        <div class="error-message hidden" id="ageError">請輸入有效的年齡（1-120歲）</div>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-neutral-dark/80 mb-1">性別 <span class="text-warning">*</span></label>
        <div class="flex space-x-4">
          <label class="inline-flex items-center">
            <input type="radio" name="gender" value="male" class="w-4 h-4 text-primary focus:ring-primary">
            <span class="ml-2">男</span>
          </label>
          <label class="inline-flex items-center">
            <input type="radio" name="gender" value="female" class="w-4 h-4 text-primary focus:ring-primary">
            <span class="ml-2">女</span>
          </label>
        </div>
        <div class="error-message hidden" id="genderError">請選擇您的性別</div>
      </div>
      
      <div>
        <label for="phone" class="block text-sm font-medium text-neutral-dark/80 mb-1">電話</label>
        <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的聯繫電話">
      </div>
    
    <div class="grid md:grid-cols-3 gap-6 mb-6">
      <div>
        <label for="height" class="block text-sm font-medium text-neutral-dark/80 mb-1">身高 (CM)</label>
        <input type="number" id="height" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="身高">
      </div>
      
      <div>
        <label for="weight" class="block text-sm font-medium text-neutral-dark/80 mb-1">體重 (KG)</label>
        <input type="number" id="weight" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="體重">
      </div>
      
      <div>
        <label for="waist" class="block text-sm font-medium text-neutral-dark/80 mb-1">腰圍 (CM)</label>
        <input type="number" id="waist" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="腰圍">
      </div>
    </div>
    
    <div class="grid md:grid-cols-2 gap-6 mb-6">
      <div>
        <label for="bloodPressure" class="block text-sm font-medium text-neutral-dark/80 mb-1">血壓 (mmHg)</label>
        <input type="text" id="bloodPressure" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="如: 120/80">
      </div>
      
      <div>
        <label for="bloodSugar" class="block text-sm font-medium text-neutral-dark/80 mb-1">血糖 (mmol/l)</label>
        <input type="number" step="0.01" id="bloodSugar" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="血糖值">
      </div>
    </div>
    
    <div>
      <label for="occupation" class="block text-sm font-medium text-neutral-dark/80 mb-1">職業</label>
      <input type="text" id="occupation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請輸入您的職業">
    </div>
  </div>
</div>

          
<!-- 步驟2: 身體症狀 -->
<div class="form-step hidden" id="step2">
  <h3 class="text-xl font-semibold mb-6 pb-2 border-b">身體症狀自檢</h3>
  <p class="text-neutral-dark/70 mb-6 text-sm">請勾選您目前存在的症狀（可多選）</p>
  
  <!-- 症狀分類標籤 -->
  <div class="flex flex-wrap gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
    <button class="symptom-tab active px-4 py-2 bg-primary text-white rounded-full text-sm whitespace-nowrap" data-category="all">全部症狀</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="head">頭部症狀</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="eye-ear-nose-throat">眼耳鼻喉</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="respiratory">呼吸系統</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="circulatory">循環系統</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="digestive">消化系統</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="endocrine">內分泌與代謝</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="muscle-joint">肌肉骨骼與關節</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="skin">皮膚與毛髮</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="female">女性症狀</button>
    <button class="symptom-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="urinary">泌尿生殖系統</button>
  </div>
    <!-- 症狀列表 -->
  <div class="grid md:grid-cols-2 gap-4 mb-6">
<!-- 頭部症狀 -->
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭痛/頭暈" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭痛/頭暈</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭部麻木/腦鳴" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭部麻木/腦鳴</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="嗜睡/易醒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">嗜睡/易醒</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="失眠/多夢" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">失眠/多夢</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="偏頭痛/健忘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">偏頭痛/健忘</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="言語懶散/口吃" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">言語懶散/口吃</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="暈車/暈機" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">暈車/暈機</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭部畏冷" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭部畏冷</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="思緒中斷" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">思緒中斷</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="反應遲鈍" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">反應遲鈍</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="容易打哈欠" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">容易打哈欠</span>
  </label>
</div>
<div class="symptom-item" data-category="head">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="眉骨疼痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">眉骨疼痛</span>
  </label>
</div>

<!-- 眼耳鼻喉 -->
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="老花眼" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">老花眼</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="眼睛癢/腫脹/突出/疼痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">眼睛癢/腫脹/突出/疼痛</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="眼睛畏光/流淚" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">眼睛畏光/流淚</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="眼睛乾澀/飛蚊症" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">眼睛乾澀/飛蚊症</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="眼糞多/麥粒腫" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">眼糞多/麥粒腫</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="眼睛疲勞" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">眼睛疲勞</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="夜盲症" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">夜盲症</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="視力模糊" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">視力模糊</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="耳朵內潮濕/化膿" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">耳朵內潮濕/化膿</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="耳垢多/耳朵疼痛/癢" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">耳垢多/耳朵疼痛/癢</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="耳鳴/耳聾" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">耳鳴/耳聾</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="聽力減退" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">聽力減退</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="鼻炎/鼻塞" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">鼻炎/鼻塞</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="流鼻水/流鼻血" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">流鼻水/流鼻血</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="打噴嚏" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">打噴嚏</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="過敏性鼻炎" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">過敏性鼻炎</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="酒渣鼻" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">酒渣鼻</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="嗅覺遲鈍" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">嗅覺遲鈍</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="咽喉異物感" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">咽喉異物感</span>
  </label>
</div>
<div class="symptom-item" data-category="eye-ear-nose-throat">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="聲音沙啞" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">聲音沙啞</span>
  </label>
</div>

<!-- 呼吸系統 -->
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="咳嗽/氣喘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">咳嗽/氣喘</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="支氣管炎" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">支氣管炎</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="感冒久不愈" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">感冒久不愈</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="容易感冒/不易感冒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">容易感冒/不易感冒</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="痰液多/黃痰/痰液清稀" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">痰液多/黃痰/痰液清稀</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="白痰/黑痰/痰中帶血" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">白痰/黑痰/痰中帶血</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="嘆氣/呼吸短促/喘氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">嘆氣/呼吸短促/喘氣</span>
  </label>
</div>
<div class="symptom-item" data-category="respiratory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="打呼" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">打呼</span>
  </label>
</div>

<!-- 循環系統 -->
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="低血壓/高血壓" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">低血壓/高血壓</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="貧血/高血脂症" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">貧血/高血脂症</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="心絞痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">心絞痛</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="心跳過快/過慢" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">心跳過快/過慢</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="心悸/心律不整" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">心悸/心律不整</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="胸悶/胸痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">胸悶/胸痛</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="右側肝區悶痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">右側肝區悶痛</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="手足麻木/發紺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">手足麻木/發紺</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="手足發熱/冰涼/腫脹/出汗" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">手足發熱/冰涼/腫脹/出汗</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭暈/頭部麻木/容易打哈欠" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭暈/頭部麻木/容易打哈欠</span>
  </label>
</div>
<div class="symptom-item" data-category="circulatory">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="面色異常（蒼白/發青）" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">面色異常（蒼白/發青）</span>
  </label>
</div>

<!-- 消化系統 -->
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="胃痛/胃酸過多/腹脹/胃部畏寒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">胃痛/胃酸過多/腹脹/胃部畏寒</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="噁心/打嗝/噯氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">噁心/打嗝/噯氣</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="消化不良" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">消化不良</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="食慾不佳/容易飽脹" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">食慾不佳/容易飽脹</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="偏食/厭食" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">偏食/厭食</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="食慾過盛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">食慾過盛</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="腹脹/排氣多/排氣臭" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">腹脹/排氣多/排氣臭</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="嘴唇蒼白/發青/麻木" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">嘴唇蒼白/發青/麻木</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="口苦/口乾/口臭/口中腥味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">口苦/口乾/口臭/口中腥味</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="口咸/口甜/口酸" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">口咸/口甜/口酸</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="口臭明顯/口中辣味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">口臭明顯/口中辣味</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="口腔潰瘍/舌潰瘍" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">口腔潰瘍/舌潰瘍</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="舌苔厚/黃苔/膩苔" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">舌苔厚/黃苔/膩苔</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="地圖舌/舌頭白斑" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">地圖舌/舌頭白斑</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="舌質紫暗/舌邊齒痕" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">舌質紫暗/舌邊齒痕</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="舌頭僵硬/舌頭前端不適" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">舌頭僵硬/舌頭前端不適</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="嘴唇龜裂/咽喉乾燥" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">嘴唇龜裂/咽喉乾燥</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="大便不成形" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">大便不成形</span>
  </label>
</div>
<div class="symptom-item" data-category="digestive">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="便溏不盡/便秘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">便溏不盡/便秘</span>
  </label>
</div>

<!-- 內分泌與代謝 -->
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="甲狀腺機能亢進/甲狀腺機能低下" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">甲狀腺機能亢進/甲狀腺機能低下</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="甲狀腺結節" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">甲狀腺結節</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="肥胖/腹型肥胖" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">肥胖/腹型肥胖</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="身體消瘦" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">身體消瘦</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="身高矮小/發育遲緩" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">身高矮小/發育遲緩</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="體重突然增加/減少10%" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">體重突然增加/減少10%</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="指甲半月痕缺失/稀少" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">指甲半月痕缺失/稀少</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="指甲易斷裂/手指倒刺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">指甲易斷裂/手指倒刺</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="指甲凹陷/指甲竪紋" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">指甲凹陷/指甲竪紋</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="血管瘤/脂肪瘤" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">血管瘤/脂肪瘤</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="纖維瘤/皮脂腺囊腫" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">纖維瘤/皮脂腺囊腫</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="膽結石/腎結石" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">膽結石/腎結石</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="扁平疣/尋常疣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">扁平疣/尋常疣</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="皮贅/雞眼" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">皮贅/雞眼</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="淋巴結腫大" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">淋巴結腫大</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="低燒37-38℃" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">低燒37-38℃</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="手足抽搐/手足顫抖" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">手足抽搐/手足顫抖</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="低血糖/高血糖" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">低血糖/高血糖</span>
  </label>
</div>
<div class="symptom-item" data-category="endocrine">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="高血脂症" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">高血脂症</span>
  </label>
</div>

<!-- 肌肉骨骼與關節 -->
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="四肢無力" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">四肢無力</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="平衡能力差/容易跌倒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">平衡能力差/容易跌倒</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="手足脫皮/凍瘡" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">手足脫皮/凍瘡</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="小腿水腫" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">小腿水腫</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="關節疼痛/腫脹" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">關節疼痛/腫脹</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="容易落枕/頸部僵硬" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">容易落枕/頸部僵硬</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="肩膀酸脹/麻木/疼痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">肩膀酸脹/麻木/疼痛</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頸部疼痛/頸部畏寒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頸部疼痛/頸部畏寒</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頸部脂肪堆積" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頸部脂肪堆積</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="腰部酸痛/腰部畏寒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">腰部酸痛/腰部畏寒</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="游離性疼痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">游離性疼痛</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="脊椎僵硬/脊椎疼痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">脊椎僵硬/脊椎疼痛</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="靜脈曲張" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">靜脈曲張</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="容易扭傷" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">容易扭傷</span>
  </label>
</div>
<div class="symptom-item" data-category="muscle-joint">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="腳跟疼痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">腳跟疼痛</span>
  </label>
</div>

<!-- 皮膚與毛髮 -->
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭髮稀疏" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭髮稀疏</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭髮乾燥/掉發" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭髮乾燥/掉發</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="白髮/圓形禿" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">白髮/圓形禿</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="頭部/面部油膩" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">頭部/面部油膩</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="臉頰泛紅" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">臉頰泛紅</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="面色黃/蒼白/黝黑" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">面色黃/蒼白/黝黑</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="痤瘡/青春痘/色素斑" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">痤瘡/青春痘/色素斑</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="皮膚容易瘀青/紅點" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">皮膚容易瘀青/紅點</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="皮膚癢/背部青春痘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">皮膚癢/背部青春痘</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="皮膚乾燥/接觸性皮膚炎" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">皮膚乾燥/接觸性皮膚炎</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="銀屑病/白斑病" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">銀屑病/白斑病</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="黑痣增大/增多" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">黑痣增大/增多</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="蜘蛛痣/魚鱗癬" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">蜘蛛痣/魚鱗癬</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="各類過敏/濕疹" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">各類過敏/濕疹</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="脂肪粒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">脂肪粒</span>
  </label>
</div>
<div class="symptom-item" data-category="skin">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="身體異味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">身體異味</span>
  </label>
</div>

<!-- 女性症狀 -->
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="不孕" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">不孕</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="流產/死胎" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">流產/死胎</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經量少/月經有血塊" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經量少/月經有血塊</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經量多/子宮肌瘤" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經量多/子宮肌瘤</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經提前/延後" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經提前/延後</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間煩躁/乳房脹痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間煩躁/乳房脹痛</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間厭食/水腫" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間厭食/水腫</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間腰痛/頭痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間腰痛/頭痛</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間嗜睡/失眠" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間嗜睡/失眠</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間腹脹/痛經" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間腹脹/痛經</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="子宮腺肌症" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">子宮腺肌症</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間下腹部畏寒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間下腹部畏寒</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間下腹部墜脹" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間下腹部墜脹</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經顏色暗/淡/深黑" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經顏色暗/淡/深黑</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期間長青春痘" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期間長青春痘</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="月經期延長" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">月經期延長</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="停經" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">停經</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="乳頭凹陷/乳頭溢膿" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">乳頭凹陷/乳頭溢膿</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="乳房腫塊/乳腺增生" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">乳房腫塊/乳腺增生</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="卵巢囊腫" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">卵巢囊腫</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="子宮頸息肉" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">子宮頸息肉</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="子宮頸肥大/子宮頸囊腫" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">子宮頸肥大/子宮頸囊腫</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="白帶增多/白帶帶血絲" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">白帶增多/白帶帶血絲</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="白帶顏色偏黃/黏稠" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">白帶顏色偏黃/黏稠</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="白帶呈稀水狀/有腥臭味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">白帶呈稀水狀/有腥臭味</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="產後掉發/產後憂鬱" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">產後掉發/產後憂鬱</span>
  </label>
</div>
<div class="symptom-item" data-category="female">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="產後色素沈澱" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">產後色素沈澱</span>
  </label>
</div>

<!-- 泌尿生殖系統 -->
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="夜尿頻繁/尿頻/尿急" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">夜尿頻繁/尿頻/尿急</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="尿不盡/尿失禁" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">尿不盡/尿失禁</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="排尿疼痛/血尿" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">排尿疼痛/血尿</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="尿分叉/排尿等待" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">尿分叉/排尿等待</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="尿液濃稠/尿液有異味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">尿液濃稠/尿液有異味</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="尿液混濁/尿液泡沫多" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">尿液混濁/尿液泡沫多</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="尿道口灼熱感/尿道口發炎" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">尿道口灼熱感/尿道口發炎</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="外陰瘙癢/外陰異味" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">外陰瘙癢/外陰異味</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="下腹部悶痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">下腹部悶痛</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="睪丸腫塊/疝氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">睪丸腫塊/疝氣</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="肛門瘙癢" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">肛門瘙癢</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="便血/痔瘡" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">便血/痔瘡</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="脫肛/肛裂/肛瘻" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">脫肛/肛裂/肛瘻</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="性慾降低" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">性慾降低</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="自汗/多汗/盜汗" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">自汗/多汗/盜汗</span>
  </label>
</div>
<div class="symptom-item" data-category="urinary">
  <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
    <input type="checkbox" name="symptoms" value="冒冷汗/後背畏寒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
    <span class="ml-2">冒冷汗/後背畏寒</span>
  </label>
</div>
</div> <!-- 閉合症狀列表容器 -->

<!-- 移除了整段其他症狀相關代碼 -->
</div>


<!-- 步驟3: 生活習慣 -->
<div class="form-step hidden" id="step3">
  <h3 class="text-xl font-semibold mb-6 pb-2 border-b">生活習慣評估</h3>
  <p class="text-neutral-dark/70 mb-6 text-sm">請勾選您存在的不良生活習慣（可多選）</p>
  
 <div class="container mx-auto px-4 py-8">
  <!-- 生活習慣分類標籤 -->
  <div class="flex flex-wrap gap-2 mb-6 overflow-x-auto scrollbar-hide pb-2">
    <button class="habit-tab active px-4 py-2 bg-primary text-white rounded-full text-sm whitespace-nowrap" data-category="all">全部習慣</button>
    <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="diet">飲食習慣</button>
    <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="sleep">睡眠習慣</button>
    <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="exercise">運動習慣</button>
    <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="cold">寒濕因素</button>
    <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="emotion">情緒因素</button>
    <button class="habit-tab px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-full text-sm whitespace-nowrap" data-category="toxin">毒素接觸</button>
  </div>
  
  <!-- 飲食習慣 -->
  <div class="mb-8">
    <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="diet">飲食習慣</h4>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經常不吃早餐" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經常不吃早餐</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="晚上8點後吃晚餐/吃消夜" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">晚上8點後吃晚餐/吃消夜</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃飯過飽/過急/過快/過少" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃飯過飽/過急/過快/過少</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經常外食/點外送" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經常外食/點外送</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="常吃剩飯剩菜/愛吃動物內臟" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">常吃剩飯剩菜/愛吃動物內臟</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="常吃葷食/吃菜偏好油多的" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">常吃葷食/吃菜偏好油多的</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="口味偏辣/偏鹹(重口味)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">口味偏辣/偏鹹(重口味)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="很少吃蔬菜/素食者" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">很少吃蔬菜/素食者</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡吃燙食/喝燙水" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡吃燙食/喝燙水</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="偏好白米/白麵等精製主食" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">偏好白米/白麵等精製主食</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="很少吃五穀雜糧" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">很少吃五穀雜糧</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="偏食/挑食/特別嗜吃某種食物" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">偏食/挑食/特別嗜吃某種食物</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="常喝酒/酗酒/喝冰啤酒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">常喝酒/酗酒/喝冰啤酒</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="習慣飯後吃水果/特別偏愛水果" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">習慣飯後吃水果/特別偏愛水果</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛吃反季節蔬菜/水果" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛吃反季節蔬菜/水果</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡吃螃蟹/柿子" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡吃螃蟹/柿子</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="不吃堅果/吃花生/瓜子過多" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">不吃堅果/吃花生/瓜子過多</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡吃泡麵/甜食" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡吃泡麵/甜食</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃油炸食品/醃製食品" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃油炸食品/醃製食品</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡吃果脯蜜餞/罐頭" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡吃果脯蜜餞/罐頭</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃冰西瓜/特別偏愛水果" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃冰西瓜/特別偏愛水果</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛吃燒烤/零食/愛吃雞頭" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛吃燒烤/零食/愛吃雞頭</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃燒烤/火鍋時搭配冰啤酒/冰飲料" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃燒烤/火鍋時搭配冰啤酒/冰飲料</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃冰棒/冰涼甜點/冰飲" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃冰棒/冰涼甜點/冰飲</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃飯不共用餐筷/吃飯快/吃燙飯/愛吃油炸物" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃飯不共用餐筷/吃飯快/吃燙飯/愛吃油炸物</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛喝濃茶/咖啡/吃醃製食物" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛喝濃茶/咖啡/吃醃製食物</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="飲食時間不規律/接觸二手菸" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">飲食時間不規律/接觸二手菸</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="常吃中藥/西藥/吃類固醇藥" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">常吃中藥/西藥/吃類固醇藥</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="吃過減肥藥/做過減肥相關療程" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">吃過減肥藥/做過減肥相關療程</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="diet">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="常吃海鮮/炒菜時油燒到冒煙" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">常吃海鮮/炒菜時油燒到冒煙</span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- 睡眠習慣 -->
  <div class="mb-8">
    <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="sleep">睡眠習慣</h4>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="超過晚上11點睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">超過晚上11點睡覺</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="早上9點後才起床" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">早上9點後才起床</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經常上大夜班(到天亮)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經常上大夜班(到天亮)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="睡眠時間不足7-8小時" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">睡眠時間不足7-8小時</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="睡軟床/用高枕頭" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">睡軟床/用高枕頭</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="開冷氣/開窗睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">開冷氣/開窗睡覺</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="飯後馬上睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">飯後馬上睡覺</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="睡覺時把腳露在被子外面" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">睡覺時把腳露在被子外面</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="早上5點前就起床(過早起床)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">早上5點前就起床(過早起床)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="sleep">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="蒙頭睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">蒙頭睡覺</span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- 寒濕相關習慣 -->
  <div class="mb-8">
    <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="cold">寒濕因素</h4>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="開窗/開冷氣睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">開窗/開冷氣睡覺</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="很少曬太陽" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">很少曬太陽</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="長時間在冷氣房工作" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">長時間在冷氣房工作</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="在地下室/冷凍庫工作" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">在地下室/冷凍庫工作</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="早上洗頭/洗澡" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">早上洗頭/洗澡</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="晚上11點後洗頭/洗澡" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">晚上11點後洗頭/洗澡</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="用冷水洗頭/洗澡/每天都洗澡" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">用冷水洗頭/洗澡/每天都洗澡</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="洗頭後沒有及時吹乾" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">洗頭後沒有及時吹乾</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="運動後馬上洗澡" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">運動後馬上洗澡</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="用冷水洗腳且不擦乾" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">用冷水洗腳且不擦乾</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡光腳在地上走" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡光腳在地上走</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="冬天用冷水洗菜/洗碗/洗衣物" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">冬天用冷水洗菜/洗碗/洗衣物</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="有下河水等嚴重受寒的經歷" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">有下河水等嚴重受寒的經歷</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡露肩膀/露腰/露腳踝" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡露肩膀/露腰/露腳踝</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="四季都穿涼鞋/冬天穿得少/穿得薄" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">四季都穿涼鞋/冬天穿得少/穿得薄</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="睡覺時把腳露在被子外面" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">睡覺時把腳露在被子外面</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="騎機車時沒有做好防護(防風保暖)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">騎機車時沒有做好防護(防風保暖)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="cold">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="出汗時/生氣時喝冰水" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">出汗時/生氣時喝冰水</span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- 情緒與心理習慣 -->
  <div class="mb-8">
    <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="emotion">情緒因素</h4>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經歷過重大情感變故" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經歷過重大情感變故</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經常生氣/愛發脾氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經常生氣/愛發脾氣</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="壓力大/精神緊張" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">壓力大/精神緊張</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="容易憤怒/憎恨他人/有內疚感/心事重" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">容易憤怒/憎恨他人/有內疚感/心事重</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="過度思念/多慮/常擔驚受怕" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">過度思念/多慮/常擔驚受怕</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="遇到事情愛抱怨/習慣找外部原因/容易嫉妒別人" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">遇到事情愛抱怨/習慣找外部原因/容易嫉妒別人</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="因父母離異而感到悲憤/有被遺棄感" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">因父母離異而感到悲憤/有被遺棄感</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經歷過喪偶/喪子(女)/喪父(母)等喪親之痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經歷過喪偶/喪子(女)/喪父(母)等喪親之痛</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="沒有人生信念/感到空虛無助" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">沒有人生信念/感到空虛無助</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="不情願讓步/習慣自己悶著生氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">不情願讓步/習慣自己悶著生氣</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="慾望無法實現/對他人感到失望" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">慾望無法實現/對他人感到失望</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="莫名暴躁/發脾氣/有憂鬱傾向" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">莫名暴躁/發脾氣/有憂鬱傾向</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="自卑/性格軟弱/缺乏安全感/感到無助" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">自卑/性格軟弱/缺乏安全感/感到無助</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="容易生氣/憤憤不平/發怒/惱怒甚至暴怒" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">容易生氣/憤憤不平/發怒/惱怒甚至暴怒</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="感到傷心/難受/痛苦/悲痛或哀痛" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">感到傷心/難受/痛苦/悲痛或哀痛</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="容易憂慮/愁悶/憂鬱/有憂鬱傾向" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">容易憂慮/愁悶/憂鬱/有憂鬱傾向</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="容易害怕/慌張/恐懼甚至驚慌" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">容易害怕/慌張/恐懼甚至驚慌</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="從小被打罵/冷落/嫌棄/受過刺激" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">從小被打罵/冷落/嫌棄/受過刺激</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="懶惰不上進/缺乏活力" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">懶惰不上進/缺乏活力</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="膽小怕事/長時間有慾望卻無法實現" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">膽小怕事/長時間有慾望卻無法實現</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="內心浮躁/沒有興趣愛好/缺乏主見" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">內心浮躁/沒有興趣愛好/缺乏主見</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="抱怨命運不好/總是遇到麻煩事" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">抱怨命運不好/總是遇到麻煩事</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="坐月子期間生氣" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">坐月子期間生氣</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="性子急/愛罵人" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">性子急/愛罵人</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="喜歡追劇/看恐怖片" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">喜歡追劇/看恐怖片</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛攀比/別人有就嫉妒/別人沒有就看不起" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛攀比/別人有就嫉妒/別人沒有就看不起</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="emotion">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="容易過度興奮/激動或亢奮" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">容易過度興奮/激動或亢奮</span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- 運動習慣 -->
  <div class="mb-8">
    <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="exercise">運動習慣</h4>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="早上5點前/晚上7點後運動" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">早上5點前/晚上7點後運動</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="不運動/運動量太少/運動量過度" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">不運動/運動量太少/運動量過度</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="長時間站立/久坐/長時間低頭伏案工作" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">長時間站立/久坐/長時間低頭伏案工作</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="每天走路超過一萬步(過量)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">每天走路超過一萬步(過量)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="長時間游泳/從事冬泳" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">長時間游泳/從事冬泳</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="體力勞動過多/特別愛游泳" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">體力勞動過多/特別愛游泳</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="練瑜伽(指可能不合適的練習方式)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">練瑜伽(指可能不合適的練習方式)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="exercise">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="曾經是體育運動員(指過往高強度運動習慣的延續影響)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">曾經是體育運動員(指過往高強度運動習慣的延續影響)</span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- 毒素接觸習慣 -->
  <div class="mb-8">
    <h4 class="font-medium text-lg mb-4 text-neutral-dark/90 habit-category-title" data-category="toxin">毒素接觸</h4>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="手機在床邊充電/放在頭附近睡覺" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">手機在床邊充電/放在頭附近睡覺</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="住家附近20公里內有化工廠等污染企業" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">住家附近20公里內有化工廠等污染企業</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經常過度疲勞/住家裝修過度(可能接觸裝修污染)" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經常過度疲勞/住家裝修過度(可能接觸裝修污染)</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="不喝水/很少喝水/喝冰水" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">不喝水/很少喝水/喝冰水</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="經常憋尿/不按時排便" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">經常憋尿/不按時排便</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="常燙髮/染髮/使用化妝品/塗指甲油" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">常燙髮/染髮/使用化妝品/塗指甲油</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="手淫/意淫/看色情影片/資料" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">手淫/意淫/看色情影片/資料</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="性生活頻繁/性慾低落" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">性生活頻繁/性慾低落</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="戴深色口罩/住在變電站附近" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">戴深色口罩/住在變電站附近</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="從小到大吃過抗生素/消炎藥" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">從小到大吃過抗生素/消炎藥</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛咬手指甲/咬筆桿/咬筷子" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛咬手指甲/咬筆桿/咬筷子</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛躺著看電視/玩手機" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛躺著看電視/玩手機</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="不使用抽油煙機/抽油煙機效果不好" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">不使用抽油煙機/抽油煙機效果不好</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="長期接觸汽車廢氣/灰塵/粉塵" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">長期接觸汽車廢氣/灰塵/粉塵</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="小孩用鉛筆剔牙/塗抹祛斑霜" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">小孩用鉛筆剔牙/塗抹祛斑霜</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="愛用84消毒液/脫色劑/強力除油劑/水果清洗劑" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">愛用84消毒液/脫色劑/強力除油劑/水果清洗劑</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="不戴正規防毒面具/防護服就噴灑農藥" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">不戴正規防毒面具/防護服就噴灑農藥</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="叼著包裝袋喝牛奶/飲料" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">叼著包裝袋喝牛奶/飲料</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="抽菸每天超過10根/長期吸二手菸" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">抽菸每天超過10根/長期吸二手菸</span>
        </label>
      </div>
      
      <div class="habit-item" data-category="toxin">
        <label class="flex items-start p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
          <input type="checkbox" name="habits" value="低頭玩手機/用電腦時間過多" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
          <span class="ml-2">低頭玩手機/用電腦時間過多</span>
        </label>
      </div>
    </div>
  </div>
 </div>
 </div>

          <!-- 步驟4: 健康評估 -->
          <div class="form-step hidden" id="step4">
            <h3 class="text-xl font-semibold mb-6 pb-2 border-b">健康問題評估</h3>
            
            <div class="space-y-6 mb-8">
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您目前最想解決的健康問題是？ <span class="text-warning">*</span></label>
                <input type="text" id="mainConcern" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述您最關注的健康問題">
                <div class="error-message hidden" id="mainConcernError">請描述您最關注的健康問題</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">這個症狀已經持續多久了？ <span class="text-warning">*</span></label>
                <select id="symptomDuration" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors">
                  <option value="">請選擇</option>
                  <option value="少於1周">少於1周</option>
                  <option value="1-4周">1-4周</option>
                  <option value="1-3個月">1-3個月</option>
                  <option value="3-6個月">3-6個月</option>
                  <option value="6個月-1年">6個月-1年</option>
                  <option value="1-3年">1-3年</option>
                  <option value="3年以上">3年以上</option>
                </select>
                <div class="error-message hidden" id="symptomDurationError">請選擇症狀持續時間</div>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您認為是什麼原因引起的？</label>
                <textarea id="possibleCauses" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述您認為的可能原因"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">在什麼情況下症狀會加重？</label>
                <textarea id="aggravatingFactors" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述加重症狀的因素"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您之前嘗試過哪些治療或調理方法？</label>
                <textarea id="previousTreatments" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="請描述您之前的治療或調理經歷"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您是否有藥物或食物過敏史？ <span class="text-warning">*</span></label>
                <div class="flex space-x-4 mb-2">
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="none" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">無</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="drug" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">藥物過敏</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="food" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">食物過敏</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="allergyHistory" value="both" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">兩者都有</span>
                  </label>
                </div>
                <div class="error-message hidden" id="allergyHistoryError">請選擇是否有過敏史</div>
                <textarea id="allergyDetails" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="如有，請詳細描述"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-neutral-dark/80 mb-2">您是否做過手術或有既往病史？ <span class="text-warning">*</span></label>
                <div class="flex space-x-4 mb-2">
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="none" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">無</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="surgery" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">做過手術</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="disease" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">有既往病史</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="radio" name="medicalHistory" value="both" class="w-4 h-4 text-primary focus:ring-primary">
                    <span class="ml-2">兩者都有</span>
                  </label>
                </div>
                <div class="error-message hidden" id="medicalHistoryError">請選擇是否有手術史或既往病史</div>
                <textarea id="medicalDetails" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-colors" placeholder="如有，請詳細描述"></textarea>
              </div>
            </div>
            
            <div class="bg-primary/5 p-5 rounded-lg">
              <h4 class="font-medium text-primary mb-2">健康宣言</h4>
              <p class="text-sm text-neutral-dark/80 mb-3">
                我已如實填寫以上信息，瞭解本表僅作為健康參考，不能替代專業醫療診斷。
                如有嚴重不適，我會及時咨詢醫生。
              </p>
              <label class="inline-flex items-start mt-2">
                <input type="checkbox" id="healthDeclaration" class="mt-1 w-4 h-4 text-primary focus:ring-primary">
                <span class="ml-2 text-sm">我已閱讀並同意以上內容 <span class="text-warning">*</span></span>
              </label>
              <div class="error-message hidden" id="declarationError">請閱讀並同意健康宣言</div>
            </div>
          </div>
        </div>
        
        <!-- 表單導航按鈕 -->
        <div class="flex justify-between">
          <button id="prevBtn" class="px-6 py-3 bg-gray-200 text-neutral-dark rounded-lg hover:bg-gray-300 transition-colors hidden">
            <i class="fa fa-arrow-left mr-2"></i> 上一步
          </button>
          <div class="ml-auto">
            <button id="nextBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
              下一步 <i class="fa fa-arrow-right ml-2"></i>
            </button>
            <button id="submitBtn" class="px-6 py-3 bg-secondary text-white rounded-lg hover:bg-secondary/90 transition-colors hidden">
              提交評估 <i class="fa fa-check ml-2"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- 填寫指南 -->
  <section id="guide" class="py-12 md:py-16 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-3xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center">填寫指南</h2>
        
        <div class="space-y-8">
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-check-circle text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">如實填寫</h3>
              <p class="text-neutral-dark/70">請根據您的實際情況如實勾選症狀和習慣，信息越準確，評估結果越有參考價值。</p>
            </div>
          </div>
          
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-clock-o text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">耐心完成</h3>
              <p class="text-neutral-dark/70">整個評估過程大約需要15-20分鐘，請預留足夠時間，盡量一次性完成所有問題。</p>
            </div>
          </div>
          
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-question-circle text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">明確症狀</h3>
              <p class="text-neutral-dark/70">如果對某些症狀描述不確定，請根據字面意思理解，或咨詢專業人士後再填寫。</p>
            </div>
          </div>
          
          <div class="flex flex-col md:flex-row gap-6 items-center">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
              <i class="fa fa-refresh text-primary text-2xl"></i>
            </div>
            <div>
              <h3 class="text-xl font-semibold mb-2">定期復查</h3>
              <p class="text-neutral-dark/70">建議每3個月重新評估一次，跟蹤健康變化趨勢，及時調整健康管理方案。</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- 結果展示區域 -->
  <section id="result" class="py-12 bg-neutral hidden">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h2 class="text-2xl md:text-3xl font-bold mb-8 text-center"><p><p><p>🧬 健康評估結果</h2>
        
        <div class="bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
          <!-- 新增基本資料部分 -->
          <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">📌 基本資料</h3>
            <div id="basicInfo" class="grid md:grid-cols-2 gap-4">
              <!-- 基本資料將在這裡動態顯示 -->
            </div>
          </div>
          
          <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">🩺 健康狀況概覽</h3>
            
            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div class="bg-neutral p-5 rounded-xl">
                <h4 class="font-medium text-lg mb-3 flex items-center">
                  <i class="fa fa-stethoscope text-primary mr-2"></i> 症狀評估
                </h4>
                <div class="flex items-center">
                  <div class="w-full bg-gray-200 rounded-full h-4 mr-3">
                    <div id="symptomScoreBar" class="bg-primary h-4 rounded-full" style="width: 0%"></div>
                  </div>
                  <span id="symptomCount" class="font-medium">0 項症狀</span>
                </div>
              </div>
              
              <div class="bg-neutral p-5 rounded-xl">
                <h4 class="font-medium text-lg mb-3 flex items-center">
                  <i class="fa fa-balance-scale text-primary mr-2"></i> 習慣評估
                </h4>
                <div class="flex items-center">
                  <div class="w-full bg-gray-200 rounded-full h-4 mr-3">
                    <div id="habitScoreBar" class="bg-warning h-4 rounded-full" style="width: 0%"></div>
                  </div>
                  <span id="habitCount" class="font-medium">0 項不良習慣</span>
                </div>
              </div>
            </div>
            
  <div class="mb-6">
    <h4 class="font-medium text-lg mb-3 flex items-center">
      <i class="fa fa-bar-chart text-primary mr-2"></i> 健康風險分布
    </h4>
    <div class="h-80"> <!-- 增加高度確保圖表完整顯示 -->
      <canvas id="healthBarChart"></canvas> <!-- ID修正為healthBarChart -->
    </div>
  </div>
 </div>
          
          <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">🟢 主要健康問題</h3>
            <div id="mainHealthIssues" class="bg-primary/5 p-5 rounded-xl">
              <!-- 結果將在這裡動態顯示 -->
            </div>
          </div>
          
          <div>
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b">🟢 六大調理方向： <p>找到健康的根本邏輯</h3>
            <div id="healthRecommendations" class="space-y-4">
              <!-- 建議將在這裡動態顯示 -->
            </div>
          </div>
        </div>
        
        <div class="text-center">
          <button id="restartBtn" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors mr-3">
            <i class="fa fa-refresh mr-2"></i> 重新評估
          </button>
          <button id="downloadReportBtn" class="px-6 py-3 bg-gray-200 text-neutral-dark rounded-lg hover:bg-gray-300 transition-colors">
            <i class="fa fa-download mr-2"></i> 下載圖片
          </button>
        </div>
      </div>
    </div>
  </section>
  
  <!-- 頁腳 -->
  <footer class="bg-neutral-dark text-white py-10">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <div class="grid md:grid-cols-3 gap-8 mb-8">
          <div>
            <h3 class="text-lg font-semibold mb-4 flex items-center">
              <i class="fa fa-heartbeat text-primary mr-2"></i> 健康自檢表
            </h3>
            <p class="text-gray-400 text-sm">
              提供專業的健康自我評估工具，<br>幫助您瞭解身體狀況，預防健康風險。
            </p>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">快速鏈接</h3>
            <ul class="space-y-2 text-sm text-gray-400">
              <li><a href="#intro" class="hover:text-primary transition-colors">關於自檢表</a></li>
              <li><a href="#guide" class="hover:text-primary transition-colors">填寫指南</a></li>
              <li><a href="#result" class="hover:text-primary transition-colors">結果解讀</a></li>
            </ul>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold mb-4">免責聲明</h3>
            <p class="text-gray-400 text-sm">
              本健康自檢表僅作為健康參考，不能替代專業醫療診斷。如有嚴重不適，請及時咨詢醫生。
            </p>
          </div>
        </div>
        
        <div class="pt-6 border-t border-gray-700 text-center text-gray-500 text-sm">
          <p>© 2025 健康自檢表 - 您的個人健康評估工具</p>
        </div>
      </div>
    </div>
  </footer>
  
  <!-- 成功提交模態框 -->
  <div id="successModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 transform transition-all">
      <div class="text-center">
        <div class="w-16 h-16 bg-secondary/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa fa-check text-secondary text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold mb-2">提交成功！</h3>
        <p class="text-neutral-dark/70 mb-6">
          您的健康評估已完成，<br>正在生成評估報告...
        </p>
        <button id="viewResultBtn" class="w-full py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
          查看評估結果
        </button>
      </div>
    </div>
  </div>
     

</head>     

<script>
// 配置常量
const ADMIN_LIFF_ID = "2007488640-PbB48ELN";
const HEALTH_CHECK_LIFF_ID = "2007488640-ReVrMPKg";
const ADMIN_SHEET_ID = "1MxnhJlr7Q5zdmMxjeoKZ5r7s8DZATRewbneiG3eDRgM";
const USER_USAGE_LIMIT = 3; // 非管理員使用次數限制
const ADMIN_CHECK_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxsl-llg3RMZZkLnje8Qq4eQNg6lK869zq5f44EMATyHMmnV_5K_6RnSbzUUGbOevqm/exec';

// 全局变量定义
let globalUniqueSymptoms = [];
let globalUniqueHabits = [];
let globalAiComment = '';
let localImageBlob = null;
let localImageName = '';
let imgbbImageUrl = '';
let imgbbDeleteUrl = '';
let currentStep = 1;
let windowHealthChart = null;
let isAdmin = false;
let userUsageCount = 0;
let currentLiffId = ADMIN_LIFF_ID;
const totalSteps = 4;
const REQUEST_TIMEOUT = 30000;
const MAX_RETRIES = 3;
const BACKEND_GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxsl-llg3RMZZkLnje8Qq4eQNg6lK869zq5f44EMATyHMmnV_5K_6RnSbzUUGbOevqm/exec';
const IMGBB_API_KEY = '60691c91e77a7ad5a7eabaf332fbdffe';
const IMGBB_UPLOAD_URL = 'https://api.imgbb.com/1/upload';
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

// Toast提示函数
function showToast(message, type = 'success') {
  // 移除现有的toast
  const existingToast = document.querySelector('.custom-toast');
  if (existingToast) document.body.removeChild(existingToast);
  
  const toast = document.createElement('div');
  toast.className = 'custom-toast';
  toast.style.cssText = `
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    padding: 12px 20px; border-radius: 6px; color: white; z-index: 99999;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2); transition: opacity 0.3s ease;
  `;
  
  if (type === 'error') {
    toast.style.background = '#ff4d4f';
  } else if (type === 'info') {
    toast.style.background = '#1890ff';
  } else if (type === 'warning') {
    toast.style.background = '#faad14';
  } else {
    toast.style.background = '#52c41a';
  }
  
  toast.textContent = message;
  document.body.appendChild(toast);
  
  // 3秒后自动消失
  setTimeout(() => {
    toast.style.opacity = '0';
    setTimeout(() => {
      if (document.body.contains(toast)) {
        document.body.removeChild(toast);
      }
    }, 300);
  }, 3000);
}

// 初始化应用程序
function initApp() {
  // 检查是否已完成管理员验证
  const adminVerified = localStorage.getItem('adminVerified') === 'true';
  const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
  
  if (adminVerified && userInfo.userId) {
    // 已验证，直接初始化健康检查LIFF
    currentLiffId = HEALTH_CHECK_LIFF_ID;
    initLiff();
  } else {
    // 未验证，先进行管理员验证
    currentLiffId = ADMIN_LIFF_ID;
    initLiff();
  }
}

// 初始化LIFF
function initLiff() {
  try {
    // 检查liff是否存在
    if (typeof liff === 'undefined') {
      throw new Error('LINE LIFF库未加载，请确保已引入LIFF SDK');
    }
    
    // 显示初始化状态
    showToast(`正在初始化LINE登录... (${currentLiffId === ADMIN_LIFF_ID ? '管理员验证' : '健康自檢表'})`, 'info');
    
    liff.init({ liffId: currentLiffId })
      .then(() => {
        // 检查是否已登录
        if (!liff.isLoggedIn()) {
          // 未登录则进行登录
          showToast('请使用LINE账号登录...', 'info');
          liff.login();
        } else {
          // 已登录则获取用户信息
          handleLoggedInUser();
        }
      })
      .catch(error => {
        console.error('LIFF初始化失败:', error);
        handleLiffInitError(error);
      });
  } catch (error) {
    console.error('LIFF初始化失败:', error);
    handleLiffInitError(error);
  }
}

// 处理已登录用户
async function handleLoggedInUser() {
  try {
    // 获取用户资料
    const profile = await liff.getProfile();
    const userId = profile.userId;
    const displayName = profile.displayName;
    
    // 保存用户信息到本地存储
    localStorage.setItem('userInfo', JSON.stringify({
      userId: userId,
      displayName: displayName,
      lastLogin: new Date().toISOString()
    }));
    
    // 根据当前LIFF ID处理不同流程
    if (currentLiffId === ADMIN_LIFF_ID) {
      // 管理员验证流程
      showToast(`LINE登录成功，正在验证身份...`, 'info');
      
      // 检查是否为管理员
      const isUserAdmin = await checkIfUserIsAdmin(userId);
      
      if (isUserAdmin) {
        // 是管理员，切换到健康检查表LIFF
        isAdmin = true;
        localStorage.setItem('adminVerified', 'true');
        showToast(`管理员验证成功，欢迎 ${displayName}`, 'success');
        
        // 关闭当前LIFF并打开健康检查表LIFF
        if (liff.isInClient()) {
          liff.openWindow({
            url: `https://liff.line.me/${HEALTH_CHECK_LIFF_ID}`,
            external: false
          });
        } else {
          // 在浏览器中直接重定向
          window.location.href = `https://liff.line.me/${HEALTH_CHECK_LIFF_ID}`;
        }
      } else {
        // 不是管理员，检查使用次数
        showToast(`您不是管理员，正在检查使用权限...`, 'info');
        await handleNonAdminUser(userId, displayName);
      }
    } else {
      // 健康检查表流程
      showToast(`LINE登录成功，欢迎 ${displayName}`, 'success');
      
      // 填充用户信息到表单
      const lineUserIdInput = document.getElementById('lineUserId');
      const lineUserNameInput = document.getElementById('lineUserName');
      
      if (lineUserIdInput) {
        lineUserIdInput.value = userId || '无法获取用户ID';
        lineUserIdInput.readOnly = true;
      }
      
      if (lineUserNameInput) {
        lineUserNameInput.value = displayName || '无法获取用户名';
        lineUserNameInput.readOnly = true;
      }
      
      // 存储到本地
      localStorage.setItem('lineUserId', userId || '');
      localStorage.setItem('lineUserName', displayName || '');
      
      // 上传用户信息
      uploadUserInfoToGoogleSheet(userId, displayName);
      
      // 初始化表单
      initForm();
    }
  } catch (error) {
    console.error('处理登录用户失败:', error);
    handleProfileError(error);
  }
}

// 检查用户是否为管理员
function checkIfUserIsAdmin(userId) {
  return requestWithRetry(() => {
    const callbackName = `adminCheckCallback_${Date.now()}`;
    const params = new URLSearchParams({
      callback: callbackName,
      userId: userId,
      sheetId: ADMIN_SHEET_ID,
      action: 'checkAdmin',
      timestamp: Date.now()
    });
    
    return jsonpRequest(
      `${ADMIN_CHECK_SCRIPT_URL}?${params.toString()}`,
      callbackName
    ).then(response => {
      return response?.status === 'success' && response.isAdmin === true;
    });
  });
}

// 处理非管理员用户
async function handleNonAdminUser(userId, displayName) {
  try {
    // 获取用户使用次数
    const usageData = await getUserUsageCount(userId);
    userUsageCount = usageData.count || 0;
    
    // 保存使用次数到本地
    localStorage.setItem('userUsageCount', userUsageCount);
    
    // 检查是否超过使用限制
    if (userUsageCount >= USER_USAGE_LIMIT) {
      showToast(`抱歉，您已超过${USER_USAGE_LIMIT}次使用限制`, 'error');
      
      // 显示超过限制的信息
      const limitInfo = document.createElement('div');
      limitInfo.style.cssText = `
        position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        z-index: 1000; text-align: center; max-width: 80%;
      `;
      limitInfo.innerHTML = `
        <h3 style="color: #ff4d4f; margin-top: 0;">使用次数已达上限</h3>
        <p>您已使用完${USER_USAGE_LIMIT}次免费使用额度</p>
        <button id="closeLimitBtn" style="margin-top: 15px; padding: 8px 16px; background: #165DFF; color: white; border: none; border-radius: 4px; cursor: pointer;">
          关闭
        </button>
      `;
      document.body.appendChild(limitInfo);
      
      document.getElementById('closeLimitBtn').addEventListener('click', () => {
        document.body.removeChild(limitInfo);
        if (liff.isInClient()) {
          liff.closeWindow();
        } else {
          window.close();
        }
      });
      
      return;
    }
    
    // 未超过限制，允许使用，但提示剩余次数
    const remaining = USER_USAGE_LIMIT - userUsageCount;
    showToast(`您还可以使用${remaining}次健康自檢表服务`, 'info');
    
    // 记录本次使用（预增1次）
    await updateUserUsageCount(userId, displayName, userUsageCount + 1);
    
    // 切换到健康检查表
    localStorage.setItem('adminVerified', 'false');
    if (liff.isInClient()) {
      liff.openWindow({
        url: `https://liff.line.me/${HEALTH_CHECK_LIFF_ID}`,
        external: false
      });
    } else {
      window.location.href = `https://liff.line.me/${HEALTH_CHECK_LIFF_ID}`;
    }
  } catch (error) {
    console.error('处理非管理员用户失败:', error);
    showToast('验证使用权限失败，请重试', 'error');
  }
}

// 获取用户使用次数
function getUserUsageCount(userId) {
  return requestWithRetry(() => {
    const callbackName = `getUsageCallback_${Date.now()}`;
    const params = new URLSearchParams({
      callback: callbackName,
      userId: userId,
      action: 'getUsageCount',
      timestamp: Date.now()
    });
    
    return jsonpRequest(
      `${BACKEND_GOOGLE_SCRIPT_URL}?${params.toString()}`,
      callbackName
    ).then(response => {
      if (response?.status === 'success') {
        return { count: parseInt(response.count || '0') };
      }
      return { count: 0 };
    });
  });
}

// 更新用户使用次数
function updateUserUsageCount(userId, displayName, count) {
  return requestWithRetry(() => {
    const callbackName = `updateUsageCallback_${Date.now()}`;
    const params = new URLSearchParams({
      callback: callbackName,
      userId: userId,
      displayName: displayName,
      count: count,
      action: 'updateUsageCount',
      timestamp: Date.now()
    });
    
    return jsonpRequest(
      `${BACKEND_GOOGLE_SCRIPT_URL}?${params.toString()}`,
      callbackName
    );
  });
}

// 上传用户信息到Google Sheet
function uploadUserInfoToGoogleSheet(userId, displayName) {
  try {
    // 显示状态
    const statusElement = document.getElementById("status");
    if (statusElement) {
      statusElement.innerText = `歡迎 ${displayName}，資料上傳中...`;
    } else {
      showToast(`正在上传用户信息...`, 'info');
    }

    // JSONP 呼叫 GAS
    const script = document.createElement('script');
    const callbackName = `userInfoCallback_${Date.now()}`;
    
    // 定义回调函数
    window[callbackName] = function(response) {
      console.log("Google Sheet 回應:", response);
      const statusElement = document.getElementById("status");
      
      if (response.status === "success") {
        const message = "✅ 登錄成功，資料已存到 Google Sheet！";
        if (statusElement) {
          statusElement.innerText = message;
        } else {
          showToast(message, 'success');
        }
      } else {
        const message = `❌ 登錄失敗: ${response.message || '未知錯誤'}`;
        if (statusElement) {
          statusElement.innerText = message;
        } else {
          showToast(message, 'error');
        }
      }
      
      // 清理
      delete window[callbackName];
      if (document.body.contains(script)) {
        document.body.removeChild(script);
      }
    };
    
    // 构建请求URL
    const params = new URLSearchParams({
      callback: callbackName,
      userId: userId,
      displayName: displayName,
      isAdmin: isAdmin ? 'true' : 'false',
      usageCount: userUsageCount,
      timestamp: Date.now()
    });
    
    script.src = `https://script.google.com/macros/s/AKfycbxsl-llg3RMZZkLnje8Qq4eQNg6lK869zq5f44EMATyHMmnV_5K_6RnSbzUUGbOevqm/exec?${params.toString()}`;
    script.type = 'text/javascript';
    script.async = true;
    
    // 错误处理
    script.onerror = function() {
      const message = "❌ 上傳失敗: 網路錯誤";
      const statusElement = document.getElementById("status");
      if (statusElement) {
        statusElement.innerText = message;
      } else {
        showToast(message, 'error');
      }
      delete window[callbackName];
      if (document.body.contains(script)) {
        document.body.removeChild(script);
      }
    };
    
    document.body.appendChild(script);
  } catch (err) {
    console.error("上傳用戶資訊錯誤:", err);
    showToast(`上傳用戶資訊失敗: ${err.message}`, 'error');
  }
}

// 初始化表单
function initForm() {
  // 获取DOM元素
  const formWrapper = document.getElementById('formWrapper') || document.getElementById('formContainer');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const successModal = document.getElementById('successModal');
  const viewResultBtn = document.getElementById('viewResultBtn');
  const restartBtn = document.getElementById('restartBtn');
  const resultSection = document.getElementById('result');
  const downloadReportBtn = document.getElementById('downloadReportBtn');
  
  // 检查LINE用户信息字段是否存在
  const lineUserIdInput = document.getElementById('lineUserId');
  const lineUserNameInput = document.getElementById('lineUserName');
  if (!lineUserIdInput || !lineUserNameInput) {
    console.warn('LINE用户信息输入框未找到，可能影响功能');
    showToast('页面配置不完整，LINE用户信息字段缺失', 'warning');
  }
  
  // 绑定按钮事件
  if (prevBtn) {
    prevBtn.addEventListener('click', () => {
      if (currentStep > 1) {
        currentStep--;
        updateFormSteps();
      }
    });
  }
  
  if (nextBtn) {
    nextBtn.addEventListener('click', () => {
      if (validateStep(currentStep)) {
        if (currentStep < totalSteps) {
          currentStep++;
          updateFormSteps();
        }
      }
    });
  }
  
  if (submitBtn) {
    submitBtn.addEventListener('click', async () => {
      updateGlobalSymptomData();
      if (!validateStep(4)) return;
      
      if (successModal) successModal.classList.remove('hidden');
      
      try {
        // 并行执行AI评估和数据提交
        const healthData = collectHealthData();
        
        // 使用Promise.allSettled确保两个操作都完成
        const [aiResult, submitResult] = await Promise.allSettled([
          callOpenAIByBackend(healthData),
          submitToGoogleSheets()
        ]);
        
        // 检查是否有一个操作成功
        const aiSuccess = aiResult.status === 'fulfilled' && aiResult.value;
        const submitSuccess = submitResult.status === 'fulfilled' && submitResult.value;
        
        if (aiSuccess || submitSuccess) {
          generateResult();
        } else {
          // 显示具体错误信息
          const errorMsg = [];
          if (aiResult.status === 'rejected') errorMsg.push(`AI評估: ${aiResult.reason.message}`);
          if (submitResult.status === 'rejected') errorMsg.push(`數據提交: ${submitResult.reason.message}`);
          
          alert(`操作失敗：\n${errorMsg.join('\n')}\n請稍後重試`);
          if (successModal) successModal.classList.add('hidden');
        }
      } catch (error) {
        console.error('提交異常：', error);
        alert(`提交失敗：${error.message}`);
        if (successModal) successModal.classList.add('hidden');
      }
    });
  }
  
  // 查看结果/重新评估按钮事件
  if (viewResultBtn) {
    viewResultBtn.addEventListener('click', () => {
      if (successModal) successModal.classList.add('hidden');
      if (resultSection) {
        resultSection.classList.remove('hidden');
        resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
      if (globalAiComment) {
        renderAiEvaluation();
      }
    });
  }
  
  if (restartBtn) {
    restartBtn.addEventListener('click', () => {
      // 重置全局数据
      globalUniqueSymptoms = [];
      globalUniqueHabits = [];
      globalAiComment = '';
      localImageBlob = null;
      localImageName = '';
      imgbbImageUrl = '';
      imgbbDeleteUrl = '';
      currentStep = 1;
      
      // 重置雷达图
      if (windowHealthChart) {
        windowHealthChart.destroy();
        windowHealthChart = null;
      }
      
      // 重置AI评估容器
      const aiEvaluationContainer = document.getElementById('aiEvaluation');
      if (aiEvaluationContainer) {
        aiEvaluationContainer.innerHTML = '';
      }
      
      // 重置表单元素（保留LINE用户信息）
      document.querySelectorAll('input, textarea, select').forEach(el => {
        if ((el.id === 'lineUserId' || el.id === 'lineUserName') && el.readOnly) {
          // 保留LINE用户信息
          return;
        }
        if (el.type === 'checkbox' || el.type === 'radio') el.checked = false;
        else el.value = '';
        el.classList.remove('error-input');
      });
      
      // 重置UI状态
      clearAllErrors();
      updateFormSteps();
      updateGenderBasedUI();
      
      if (resultSection) resultSection.classList.add('hidden');
      if (formWrapper) formWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });
  }
  
  // 症状/习惯分类筛选
  document.querySelectorAll('.symptom-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      // 更新标签样式
      document.querySelectorAll('.symptom-tab').forEach(t => {
        t.classList.remove('active', 'bg-primary', 'text-white');
        t.classList.add('bg-gray-200', 'hover:bg-gray-300');
      });
      tab.classList.add('active', 'bg-primary', 'text-white');
      tab.classList.remove('bg-gray-200', 'hover:bg-gray-300');
      
      const selectedCategory = tab.getAttribute('data-category');
      const selectedGender = document.querySelector('input[name="gender"]:checked')?.value;
      
      // 筛选症状
      document.querySelectorAll('.symptom-item').forEach(item => {
        const itemCategory = item.getAttribute('data-category');
        const isPostpartum = item.hasAttribute('data-special') && item.getAttribute('data-special') === 'postpartum';
        
        if (selectedGender === 'male') {
          if (itemCategory === 'female' || isPostpartum) { 
            item.style.display = 'none'; 
            return; 
          }
        }
        
        item.style.display = (selectedCategory === 'all' || itemCategory === selectedCategory) ? 'block' : 'none';
      });
      
      updateGlobalSymptomData();
    });
  });
  
  document.querySelectorAll('.habit-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      // 更新标签样式
      document.querySelectorAll('.habit-tab').forEach(t => {
        t.classList.remove('active', 'bg-primary', 'text-white');
        t.classList.add('bg-gray-200', 'hover:bg-gray-300');
      });
      tab.classList.add('active', 'bg-primary', 'text-white');
      tab.classList.remove('bg-gray-200', 'hover:bg-gray-300');
      
      const selectedCategory = tab.getAttribute('data-category');
      
      // 筛选习惯项
      document.querySelectorAll('.habit-item').forEach(item => {
        item.style.display = (selectedCategory === 'all' || item.getAttribute('data-category') === selectedCategory) ? 'block' : 'none';
      });
      
      // 筛选习惯分类标题
      document.querySelectorAll('.habit-category-title').forEach(title => {
        title.parentElement.style.display = (selectedCategory === 'all' || title.getAttribute('data-category') === selectedCategory) ? 'block' : 'none';
      });
      
      updateGlobalSymptomData();
    });
  });
  
  // 绑定下载报告按钮事件
  if (downloadReportBtn) {
    downloadReportBtn.addEventListener('click', handleImageDownload);
  }
  
  // 性别选择变化时更新UI
  document.querySelectorAll('input[name="gender"]').forEach(radio => {
    radio.addEventListener('change', updateGenderBasedUI);
  });
  
  // 页面初始化
  updateFormSteps();
  updateGenderBasedUI();
}

// 处理用户信息获取错误
function handleProfileError(profileError) {
  console.error('获取用户信息失败:', profileError);
  showToast('已登录但无法获取用户信息', 'error');
  
  // 仍然尝试显示用户ID（如果可用）
  const lineUserIdInput = document.getElementById('lineUserId');
  const lineUserNameInput = document.getElementById('lineUserName');
  
  if (liff.getDecodedIDToken) {
    try {
      const idToken = liff.getDecodedIDToken();
      if (lineUserIdInput && idToken.sub) {
        lineUserIdInput.value = idToken.sub;
        lineUserIdInput.readOnly = true;
        localStorage.setItem('lineUserId', idToken.sub);
        
        // 尝试上传获取到的用户ID
        uploadUserInfoToGoogleSheet(idToken.sub, idToken.name || '未知用戶');
      }
      
      // 尝试从ID Token获取用户名
      if (lineUserNameInput && idToken.name) {
        lineUserNameInput.value = idToken.name;
        lineUserNameInput.readOnly = true;
        localStorage.setItem('lineUserName', idToken.name);
      }
    } catch (tokenError) {
      console.error('获取ID Token失败:', tokenError);
      enableManualInput();
    }
  } else {
    // 如果没有getDecodedIDToken方法，允许手动输入
    enableManualInput();
  }
}

// 处理LIFF初始化错误
function handleLiffInitError(error) {
  // 详细的错误提示
  let errorMsg = 'LINE登录功能初始化失败: ';
  if (error.message.includes('was not found')) {
    errorMsg += '无效的LIFF ID，请检查并更新';
  } else if (error.message.includes('permission denied')) {
    errorMsg += '没有访问权限，请检查LIFF应用设置';
  } else if (error.message.includes('未找到LINE用户信息输入框')) {
    errorMsg += '页面中未找到LINE用户ID和名称的输入框';
  } else {
    errorMsg += error.message;
  }
  showToast(errorMsg, 'error');
  
  // 提供手动输入选项
  enableManualInput();
}

// 允许手动输入LINE信息
function enableManualInput() {
  const lineUserIdInput = document.getElementById('lineUserId');
  const lineUserNameInput = document.getElementById('lineUserName');
  if (lineUserIdInput) {
    lineUserIdInput.readOnly = false;
    lineUserIdInput.placeholder = 'LINE登录失败，请手动输入用户ID';
  }
  if (lineUserNameInput) {
    lineUserNameInput.readOnly = false;
    lineUserNameInput.placeholder = 'LINE登录失败，请手动输入用户名';
  }
}

// 收集AI所需精簡健康數據
function collectHealthData() {
  // 获取LINE用户信息的增强逻辑
  let lineUserId = '';
  let lineUserName = '';
  
  // 优先从输入框获取
  const lineUserIdInput = document.getElementById('lineUserId');
  const lineUserNameInput = document.getElementById('lineUserName');
  
  if (lineUserIdInput) lineUserId = lineUserIdInput.value || '';
  if (lineUserNameInput) lineUserName = lineUserNameInput.value || '';
  
  // 如果输入框没有，则从localStorage获取
  if (!lineUserId) lineUserId = localStorage.getItem('lineUserId') || '';
  if (!lineUserName) lineUserName = localStorage.getItem('lineUserName') || '';
  
  const selectedGender = document.querySelector('input[name="gender"]:checked');
  return {
    basicInfo: {
      name: document.getElementById('name').value || '未填寫',
      age: document.getElementById('age').value || '未填寫',
      gender: selectedGender ? (selectedGender.value === 'male' ? '男' : '女') : '未填寫',
      bmi: calculateBMI(),
      bloodPressure: document.getElementById('bloodPressure').value || '未填寫',
      // 新增：Line用戶信息
      lineUserId: lineUserId || '未填寫',
      lineUserName: lineUserName || '未填寫',
      isAdmin: isAdmin
    },
    symptoms: globalUniqueSymptoms.join('; '),
    symptomCount: globalUniqueSymptoms.length,
    habits: globalUniqueHabits.join('; '),
    habitCount: globalUniqueHabits.length,
    healthIssues: {
      mainConcern: document.getElementById('mainConcern').value || '未明確說明',
      symptomDuration: document.getElementById('symptomDuration').value || '未說明'
    }
  };
}

// 收集全量表單數據
function collectFullFormData() {
  // 获取LINE用户信息的增强逻辑
  let lineUserId = '';
  let lineUserName = '';
  
  // 优先从输入框获取
  const lineUserIdInput = document.getElementById('lineUserId');
  const lineUserNameInput = document.getElementById('lineUserName');
  
  if (lineUserIdInput) lineUserId = lineUserIdInput.value || '';
  if (lineUserNameInput) lineUserName = lineUserNameInput.value || '';
  
  // 如果输入框没有，则从localStorage获取
  if (!lineUserId) lineUserId = localStorage.getItem('lineUserId') || '';
  if (!lineUserName) lineUserName = localStorage.getItem('lineUserName') || '';
  
  const selectedGender = document.querySelector('input[name="gender"]:checked');
  return {
    submitTime: new Date().toLocaleString('zh-Hant', {
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit', second: '2-digit'
    }),
    basicInfo: {
      name: document.getElementById('name').value || '未填寫',
      age: document.getElementById('age').value || '未填寫',
      gender: selectedGender ? (selectedGender.value === 'male' ? '男' : '女') : '未填寫',
      phone: document.getElementById('phone').value || '未填寫',
      // 确保LINE用户信息被包含
      lineUserId: lineUserId || '未填寫',
      lineUserName: lineUserName || '未填寫',
      isAdmin: isAdmin,
      usageCount: userUsageCount,
      height: document.getElementById('height').value ? `${document.getElementById('height').value} cm` : '未填寫',
      weight: document.getElementById('weight').value ? `${document.getElementById('weight').value} kg` : '未填寫',
      bmi: calculateBMI(),
      waist: document.getElementById('waist').value ? `${document.getElementById('waist').value} cm` : '未填寫',
      bloodPressure: document.getElementById('bloodPressure').value || '未填寫',
      bloodSugar: document.getElementById('bloodSugar').value ? `${document.getElementById('bloodSugar').value} mmol/l` : '未填寫',
      occupation: document.getElementById('occupation').value || '未填寫'
    },
    symptoms: globalUniqueSymptoms.join('; '),
    symptomCount: globalUniqueSymptoms.length,
    habits: globalUniqueHabits.join('; '),
    habitCount: globalUniqueHabits.length,
    healthIssues: {
      mainConcern: document.getElementById('mainConcern').value || '未明確說明',
      symptomDuration: document.getElementById('symptomDuration').value || '未說明',
      possibleCauses: document.getElementById('possibleCauses').value || '未說明',
      allergyHistory: document.querySelector('input[name="allergyHistory"]:checked')?.value || '未選擇',
      medicalHistory: document.querySelector('input[name="medicalHistory"]:checked')?.value || '未選擇'
    },
    aiComment: globalAiComment || 'AI評語生成失敗',
    imgbb: {
      imageUrl: imgbbImageUrl || '未上傳',
      deleteUrl: imgbbDeleteUrl || '無'
    }
  };
}

// 工具函数：BMI计算
function calculateBMI() {
  const height = document.getElementById('height').value;
  const weight = document.getElementById('weight').value;
  if (!height || !weight) return '未計算';
  
  const h = parseFloat(height) / 100; // 转米单位
  const w = parseFloat(weight);
  if (h <= 0) return '未計算';
  
  const bmiValue = (w / (h * h)).toFixed(1);
  let bmiStatus = '';
  if (bmiValue < 18.5) bmiStatus = '（偏瘦）';
  else if (bmiValue < 24) bmiStatus = '（正常）';
  else if (bmiValue < 28) bmiStatus = '（超重）';
  else bmiStatus = '（肥胖）';
  return `${bmiValue} ${bmiStatus}`;
}

// 更新全局症状数据
function updateGlobalSymptomData() {
  globalUniqueSymptoms = [];
  globalUniqueHabits = [];
  
  // 收集所有选中的症状
  document.querySelectorAll('.symptom-item input[type="checkbox"]:checked').forEach(checkbox => {
    const symptomText = checkbox.nextElementSibling.textContent.trim();
    if (symptomText && !globalUniqueSymptoms.includes(symptomText)) {
      globalUniqueSymptoms.push(symptomText);
    }
  });
  
  // 收集所有选中的习惯
  document.querySelectorAll('.habit-item input[type="checkbox"]:checked').forEach(checkbox => {
    const habitText = checkbox.nextElementSibling.textContent.trim();
    if (habitText && !globalUniqueHabits.includes(habitText)) {
      globalUniqueHabits.push(habitText);
    }
  });
}

// 根据性别更新UI
function updateGenderBasedUI() {
  const selectedGender = document.querySelector('input[name="gender"]:checked')?.value;
  
  // 更新症状显示
  document.querySelectorAll('.symptom-item').forEach(item => {
    const isFemaleSpecific = item.getAttribute('data-category') === 'female';
    const isPostpartum = item.hasAttribute('data-special') && item.getAttribute('data-special') === 'postpartum';
    
    if (selectedGender === 'male' && (isFemaleSpecific || isPostpartum)) {
      item.style.display = 'none';
    } else {
      item.style.display = 'block';
    }
  });
  
  // 更新当前选中的标签页
  const activeSymptomTab = document.querySelector('.symptom-tab.active');
  if (activeSymptomTab) {
    activeSymptomTab.click();
  }
  
  const activeHabitTab = document.querySelector('.habit-tab.active');
  if (activeHabitTab) {
    activeHabitTab.click();
  }
}

// 清除所有错误提示
function clearAllErrors() {
  document.querySelectorAll('.error-message').forEach(el => el.classList.add('hidden'));
  document.querySelectorAll('input, select, textarea').forEach(el => el.classList.remove('error-input'));
}

// 显示单个错误提示
function showError(fieldId, message) {
  const errorElement = document.getElementById(`${fieldId}Error`);
  if (errorElement) {
    errorElement.textContent = message;
    errorElement.classList.remove('hidden');
  }
  const inputElement = document.getElementById(fieldId);
  if (inputElement) {
    inputElement.classList.add('error-input');
    inputElement.focus();
    inputElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
  } else {
    const fieldGroup = document.querySelector(`input[name="${fieldId}"]`)?.closest('div');
    if (fieldGroup) fieldGroup.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
}

// 步骤验证
function validateStep(step) {
  let isValid = true;
  clearAllErrors();
  
  // 步骤1：基本信息验证
  if (step === 1) {
    const name = document.getElementById('name').value.trim();
    const age = document.getElementById('age').value.trim();
    const genderSelected = document.querySelector('input[name="gender"]:checked');
    const lineUserIdInput = document.getElementById('lineUserId');
    
    if (!name) {
      showError('name', '请输入姓名');
      isValid = false;
    }
    if (!age) {
      showError('age', '请输入年龄');
      isValid = false;
    } else if (isNaN(age) || parseInt(age) <= 0 || parseInt(age) > 120) {
      showError('age', '请输入有效的年龄（1-120）');
      isValid = false;
    }
    if (!genderSelected) {
      showError('gender', '请选择性别');
      isValid = false;
    }
    
    // 对LINE用户信息进行验证（如果字段存在）
    if (lineUserIdInput && lineUserIdInput.readOnly && !lineUserIdInput.value.trim()) {
      showError('lineUserId', 'LINE用户ID获取失败，请刷新页面重试');
      isValid = false;
    }
  }
  // 步骤4：健康评估验证
  else if (step === 4) {
    const mainConcern = document.getElementById('mainConcern').value.trim();
    const symptomDuration = document.getElementById('symptomDuration').value;
    const allergySelected = document.querySelector('input[name="allergyHistory"]:checked');
    const medicalSelected = document.querySelector('input[name="medicalHistory"]:checked');
    const declarationChecked = document.getElementById('healthDeclaration').checked;
    
    if (!mainConcern && globalUniqueSymptoms.length > 0) {
      showError('mainConcern', `請描述您最關注的健康問題（可從選中症狀：${globalUniqueSymptoms.slice(0,2).join('、')}... 中選擇）`);
      isValid = false;
    } else if (!mainConcern) {
      showError('mainConcern', '請描述您最關注的健康問題');
      isValid = false;
    }
    if (!symptomDuration) { 
      showError('symptomDuration', '請選擇症狀持續時間'); 
      isValid = false; 
    }
    if (!allergySelected) { 
      showError('allergyHistory', '請選擇是否有過敏史'); 
      isValid = false; 
    }
    if (!medicalSelected) { 
      showError('medicalHistory', '請選擇是否有手術史或既往病史'); 
      isValid = false; 
    }
    if (!declarationChecked) { 
      showError('declaration', '請閱讀並同意健康宣言'); 
      isValid = false; 
    }
  }
  return isValid;
}

// 通用JSONP请求函数
function jsonpRequest(url, callbackName, timeout = REQUEST_TIMEOUT) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = url;
    script.type = 'text/javascript';
    script.async = true;
    
    // 超时处理
    const timeoutId = setTimeout(() => {
      cleanup();
      reject(new Error('請求超時'));
    }, timeout);
    
    // 成功回调
    window[callbackName] = function(response) {
      cleanup();
      resolve(response);
    };
    
    // 错误处理
    script.onerror = function() {
      cleanup();
      reject(new Error('網路錯誤'));
    };
    
    // 清理函数
    function cleanup() {
      clearTimeout(timeoutId);
      delete window[callbackName];
      if (document.body.contains(script)) {
        document.body.removeChild(script);
      }
    }
    
    document.body.appendChild(script);
  });
}

// 带重试的请求函数
async function requestWithRetry(requestFn, retries = MAX_RETRIES, delay = 1000) {
  try {
    return await requestFn();
  } catch (error) {
    if (retries > 0) {
      await new Promise(resolve => setTimeout(resolve, delay));
      return requestWithRetry(requestFn, retries - 1, delay * 2); // 指数退避
    }
    throw error;
  }
}

// 调用后端生成AI评语
async function callOpenAIByBackend(healthData) {
  const aiEvaluationContainer = document.getElementById('aiEvaluation');
  if (!aiEvaluationContainer) return false;
  
  try {
    // 显示加载状态
    aiEvaluationContainer.innerHTML = `
      <div class="bg-blue-50 p-4 rounded-lg border border-blue-100 mt-4">
        <h4 class="font-semibold text-primary mb-2 flex items-center">
          <i class="fa fa-spinner fa-spin mr-2"></i> AI正在分析您的健康數據...
        </h4>
        <p class="text-sm text-gray-600">預計需要10-15秒，請稍候...</p>
      </div>
    `;
    
    // 构建完整请求数据
    const formData = {
      basicInfo: healthData.basicInfo,
      symptoms: healthData.symptoms,
      symptomCount: healthData.symptomCount,
      habits: healthData.habits,
      habitCount: healthData.habitCount,
      healthIssues: healthData.healthIssues
    };
    
    // 使用带重试的JSONP请求
    const callbackName = `jsonpAiCallback_${Date.now()}`;
    const params = new URLSearchParams({
      data: JSON.stringify(formData),
      callback: callbackName,
      action: 'generateAiComment',
      timestamp: Date.now() // 防止缓存
    });
    
    const requestFn = () => jsonpRequest(
      `${BACKEND_GOOGLE_SCRIPT_URL}?${params.toString()}`,
      callbackName
    );
    
    const response = await requestWithRetry(requestFn);
    if (response?.status === 'success' && response.aiComment) {
      globalAiComment = response.aiComment;
      renderAiEvaluation();
      return true;
    } else {
      throw new Error(response?.message || 'AI評語生成失敗，後端未返回有效數據');
    }
  } catch (error) {
    console.error('AI評語生成失敗：', error);
    // 显示错误+重试按钮
    aiEvaluationContainer.innerHTML = `
      <div class="bg-red-50 p-4 rounded-lg border border-red-100 mt-4">
        <h4 class="font-semibold text-red-600 mb-2">AI評估生成失敗</h4>
        <p class="text-sm text-gray-600 mb-3">原因：${error.message || '網路異常，請檢查網路後重試'}</p>
        <button id="aiRetryBtn" class="px-3 py-1 bg-primary text-white rounded text-sm hover:bg-primary/90">
          <i class="fa fa-refresh mr-1"></i> 重新生成
        </button>
      </div>
    `;
    // 绑定重试事件
    document.getElementById('aiRetryBtn')?.addEventListener('click', async () => {
      const healthData = collectHealthData();
      await callOpenAIByBackend(healthData);
    });
    return false;
  }
}

// 渲染AI评估结果
function renderAiEvaluation() {
  const aiEvaluationContainer = document.getElementById('aiEvaluation');
  if (!aiEvaluationContainer || !globalAiComment) return;
  
  // 格式化评语
  const formattedComment = globalAiComment
    .split('\n')
    .filter(para => para.trim())
    .map(para => `<p class="text-sm mb-2">${para}</p>`)
    .join('');
    
  aiEvaluationContainer.innerHTML = `
    <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mt-4">
      <h3 class="text-lg font-semibold mb-4 text-primary">
        <i class="fa fa-robot mr-2"></i>🟢 健康自檢表 AI評估
      </h3>
      <div class="text-gray-700">${formattedComment}</div>
      <p class="text-xs text-gray-500 mt-3">
        提示：此評語基於自檢表數據生成，僅供參考，不能替代醫生診斷
      </p>
    </div>
  `;
}

// 提交数据到Google Sheets
function submitToGoogleSheets() {
  return requestWithRetry(() => {
    const formData = collectFullFormData();
    const callbackName = `jsonpSubmitCallback_${Date.now()}`;
    const params = new URLSearchParams({
      data: JSON.stringify(formData),
      callback: callbackName,
      action: 'saveToSheets',
      timestamp: Date.now() // 防止缓存
    });
    
    return jsonpRequest(
      `${BACKEND_GOOGLE_SCRIPT_URL}?${params.toString()}`,
      callbackName
    ).then(response => {
      if (response?.status === 'success') {
        return true;
      } else {
        throw new Error(response?.message || '數據提交失敗，後端未確認保存');
      }
    });
  });
}

// 更新表单步骤
function updateFormSteps() {
  // 切换步骤显示状态
  document.querySelectorAll('.form-step').forEach(step => {
    step.classList.add('hidden');
    step.classList.remove('active');
  });
  
  const currentStepEl = document.getElementById(`step${currentStep}`);
  if (currentStepEl) {
    currentStepEl.classList.remove('hidden');
    currentStepEl.classList.add('active');
  }
  
  // 更新步骤指示器
  document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
    if (index + 1 < currentStep) {
      indicator.classList.remove('bg-gray-200', 'text-gray-500');
      indicator.classList.add('bg-primary', 'text-white');
    } else if (index + 1 === currentStep) {
      indicator.classList.remove('bg-gray-200', 'text-gray-500');
      indicator.classList.add('bg-primary', 'text-white');
    } else {
      indicator.classList.remove('bg-primary', 'text-white');
      indicator.classList.add('bg-gray-200', 'text-gray-500');
    }
  });
  
  // 更新进度条宽度
  document.querySelectorAll('.step-progress').forEach((progress, index) => {
    progress.style.width = index + 1 < currentStep ? '100%' : '0%';
  });
  
  // 控制按钮显示隐藏
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  
  if (prevBtn) prevBtn.classList.toggle('hidden', currentStep === 1);
  if (nextBtn) nextBtn.classList.toggle('hidden', currentStep === totalSteps);
  if (submitBtn) submitBtn.classList.toggle('hidden', currentStep !== totalSteps);
  
  // 滚动到当前表单区域
  const formWrapper = document.getElementById('formWrapper') || document.getElementById('formContainer');
  if (formWrapper) {
    formWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
}

// 生成评估结果
function generateResult() {
  const resultSection = document.getElementById('result');
  if (!resultSection) return;
  
  // 1. 加载基本信息
  const name = document.getElementById('name').value || '未填寫';
  const age = document.getElementById('age').value || '未填寫';
  const selectedGender = document.querySelector('input[name="gender"]:checked');
  const gender = selectedGender ? (selectedGender.value === 'male' ? '男' : '女') : '未填寫';
  const phone = document.getElementById('phone').value || '未填寫';
  
  // 新增：Line用户信息
  const lineUserIdInput = document.getElementById('lineUserId');
  const lineUserNameInput = document.getElementById('lineUserName');
  let lineUserId = lineUserIdInput ? lineUserIdInput.value || '未填寫' : '未填寫';
  let lineUserName = lineUserNameInput ? lineUserNameInput.value || '未填寫' : '未填寫';
  
  // 从localStorage补充LINE用户信息
  if (!lineUserId) lineUserId = localStorage.getItem('lineUserId') || '未填寫';
  if (!lineUserName) lineUserName = localStorage.getItem('lineUserName') || '未填寫';
  
  const height = document.getElementById('height').value ? `${document.getElementById('height').value} cm` : '未填寫';
  const weight = document.getElementById('weight').value ? `${document.getElementById('weight').value} kg` : '未填寫';
  const waist = document.getElementById('waist').value ? `${document.getElementById('waist').value} cm` : '未填寫';
  const bloodPressure = document.getElementById('bloodPressure').value || '未填寫';
  const bloodSugar = document.getElementById('bloodSugar').value ? `${document.getElementById('bloodSugar').value} mmol/l` : '未填寫';
  const occupation = document.getElementById('occupation').value || '未填寫';
  const bmi = calculateBMI();
  
  // 显示用户类型和剩余次数
  const userTypeInfo = isAdmin ? 
    '<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">管理員賬號</span>' : 
    `<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">普通用戶 (剩餘${USER_USAGE_LIMIT - userUsageCount}次)</span>`;
  
  // 2. 渲染基本信息卡片
  const basicInfoContainer = document.getElementById('basicInfo');
  if (basicInfoContainer) {
    basicInfoContainer.style.display = 'block';
    basicInfoContainer.innerHTML = `
      <div class="grid grid-cols-2 gap-2">
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>姓名：</strong> ${name}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>年齡：</strong> ${age} 歲</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>性別：</strong> ${gender}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>電話：</strong> ${phone}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>Line用戶ID：</strong> ${lineUserId}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>用戶類型：</strong> ${userTypeInfo}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>身高：</strong> ${height}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>體重：</strong> ${weight}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>BMI：</strong> ${bmi}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>腰圍：</strong> ${waist}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>血壓：</strong> ${bloodPressure}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>血糖：</strong> ${bloodSugar}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg col-span-2">
          <p class="text-sm"><strong>職業：</strong> ${occupation}</p>
        </div>
      </div>
    `;
  } else {
    const newBasicInfo = document.createElement('div');
    newBasicInfo.id = 'basicInfo';
    newBasicInfo.className = 'basic-info-container mt-6';
    newBasicInfo.innerHTML = `
      <h3 class="text-lg font-semibold mb-4">基本資料</h3>
      <div class="grid grid-cols-2 gap-2">
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>姓名：</strong> ${name}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>年齡：</strong> ${age} 歲</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>Line用戶ID：</strong> ${lineUserId}</p>
        </div>
        <div class="p-3 border border-gray-100 rounded-lg">
          <p class="text-sm"><strong>用戶類型：</strong> ${userTypeInfo}</p>
        </div>
      </div>
    `;
    
    const resultHeader = resultSection.querySelector('h2') || resultSection.firstChild;
    resultSection.insertBefore(newBasicInfo, resultHeader.nextSibling);
  }
  
  // 3. 加载症状/习惯统计数据
  const totalSymptomCount = globalUniqueSymptoms.length;
  const habitCount = globalUniqueHabits.length;
  
  // 4. 六大调理方向得分计算
  const adjustmentDirections = {
    體質: [
      '頭部畏冷', '四肢無力', '平衡能力差/容易跌倒', '思緒中斷', '反應遲鈍', '容易打哈欠',
      '眼睛疲勞', '耳鳴/耳聾', '聽力減退', '嗅覺遲鈍', '咽喉異物感', '聲音沙啞',
      '嘆氣/呼吸短促/喘氣', '打呼', '手足麻木/發紺', '手足發熱/冰涼/腫脹/出汗',
      '胃痛/胃酸過多/腹脹/胃部畏寒', '惡心/打嗝/噯氣', '消化不良', '食慾不佳/容易飽脹',
      '偏食/厭食', '食慾過盛', '嘴唇蒼白/發青/麻木', '嘴唇龜裂/咽喉乾燥',
      '手足抽搐/手足顫抖', '關節疼痛/腫脹', '腰部酸痛/腰部畏寒', '容易落枕/頸部僵硬',
      '肩膀酸脹/麻木/疼痛', '頸部疼痛/頸部畏寒', '頸部脂肪堆積', '游離性疼痛',
      '脊椎僵硬/脊椎疼痛', '容易扭傷', '腳跟疼痛', '手足脫皮/凍瘡',
      '月經期間下腹部畏寒', '月經期間下腹部墜脹', '月經期間腹脹/痛經', '月經期間腰痛/頭痛',
      '月經期間嗜睡/失眠', '月經期間厭食/水腫', '月經期間煩躁/乳房脹痛',
      '夜尿頻繁/尿頻/尿急', '尿不盡/尿失禁', '外陰瘙癢/外陰異味',
      '大便不成形', '便溏不盡/便秘', '低燒37-38℃', '感冒久不愈', '容易感冒/不易感冒'
    ],
    免疫: [
      '過敏性鼻炎', '眼睛癢/腫脹/突出/疼痛', '眼睛畏光/流淚', '眼睛乾澀/飛蚊症',
      '咳嗽/氣喘', '支氣管炎', '痰液多/黃痰/痰液清稀', '白痰/黑痰/痰中帶血',
      '口腔潰瘍/舌潰瘍', '淋巴結腫大', '各類過敏/濕疹', '皮膚癢/背部青春痘',
      '銀屑病/白斑病', '黑痣增大/增多', '蜘蛛痣/魚鱗病', '扁桃腺炎', '皮膚容易瘀青/紅點'
    ],
    毒素: [
      '眼糞多/麥粒腫', '耳朵內潮濕/化膿', '耳垢多/耳朵疼痛/癢', '鼻炎/鼻塞',
      '流鼻水/流鼻血', '打噴嚏', '酒渣鼻', '口苦/口乾/口臭/口中腥味',
      '口咸/口甜/口酸', '口臭明顯/口中辣味', '舌苔厚/黃苔/膩苔', '地圖舌/舌頭白斑',
      '舌質紫暗/舌邊齒痕', '舌頭僵硬/舌頭前端不適', '腹脹/排氣多/排氣臭',
      '血管瘤/脂肪瘤', '纖維瘤/皮脂腺囊腫', '膽結石/腎結石', '扁平疣/尋常疣',
      '皮贅/雞眼', '頭部/面部油膩', '臉頰泛紅', '面色黃/蒼白/黝黑',
      '痤瘡/青春痘/色素斑', '皮膚乾燥/接觸性皮炎', '脂肪粒', '身體異味',
      '白帶增多/白帶帶血絲', '白帶顏色偏黃/黏稠', '白帶呈稀水狀/有腥臭味',
      '月經期間長青春痘', '月經顏色暗/淡/深黑', '排尿疼痛/血尿', '尿分叉/排尿等待',
      '尿液濃稠/尿液有異味', '尿液混濁/尿液泡沫多', '尿道口灼熱感/尿道口發炎'
    ],
    營養: [
      '老花眼', '夜盲症', '視力模糊', '貧血/高血脂症', '身體消瘦', '肥胖/腹型肥胖',
      '身高矮小/發育遲緩', '體重突然增加/減少10%', '指甲半月痕缺失/稀少',
      '指甲易斷裂/手指倒刺', '指甲凹陷/指甲竪紋', '頭髮稀疏', '頭髮乾燥/掉發', '白髮/圓形禿'
    ],
    循環: [
      '頭痛/頭暈', '頭部麻木/腦鳴', '嗜睡/易醒', '失眠/多夢', '偏頭痛/健忘',
      '言語懶散/口吃', '暈車/暈機', '眉骨疼痛', '低血壓/高血壓', '心絞痛',
      '心跳過快/過慢', '心悸/心律不整', '胸悶/胸痛', '右側肝區悶痛',
      '頭暈/頭部麻木/容易打哈欠', '面色異常（蒼白/發青）', '低血糖/高血糖', '高血脂症',
      '小腿水腫', '靜脈曲張', '下腹部悶痛', '睪丸腫塊/疝氣', '肛門瘙癢',
      '便血/痔瘡', '脫肛/肛裂/肛瘻'
    ],
    內分泌: [
      '甲狀腺機能亢進/甲狀腺機能低下', '甲狀腺結節', '肥胖/腹型肥胖', '身體消瘦',
      '體重突然增加/減少10%', '低血糖/高血糖', '高血脂症', '低燒37-38℃',
      '產後掉發/產後憂鬱', '產後色素沈澱', '不孕', '流產/死胎', '月經量少/月經有血塊',
      '月經量多/子宮肌瘤', '月經提前/延後', '子宮腺肌症', '停經', '乳頭凹陷/乳頭溢膿',
      '乳房腫塊/乳腺增生', '卵巢囊腫', '子宮頸息肉', '子宮頸肥大/子宮頸囊腫',
      '性慾降低', '自汗/多汗/盜汗', '冒冷汗/後背畏寒'
    ]
  };
  
  // 计算得分
  const calculateAdjustmentScores = () => {
    const scores = {};
    const allIssues = [...globalUniqueSymptoms, ...globalUniqueHabits];
    
    Object.entries(adjustmentDirections).forEach(([dir, relatedItems]) => {
      const matchedCount = allIssues.filter(item => relatedItems.includes(item)).length;
      const totalRelated = relatedItems.length || 1;
      scores[dir] = Math.max(0, Math.round((1 - matchedCount / totalRelated) * 100));
    });
    
    return scores;
  };
  
  const adjustmentScores = calculateAdjustmentScores();
  const adjustmentLabels = Object.keys(adjustmentScores);
  const adjustmentData = Object.values(adjustmentScores);
  
  // 5. 渲染雷达图
  const ctx = document.getElementById('healthBarChart')?.getContext('2d');
  if (ctx) {
    if (windowHealthChart) windowHealthChart.destroy();
    
    // 空数据提示
    if (adjustmentData.every(score => score === 100) && totalSymptomCount === 0) {
      const chartParent = document.getElementById('healthBarChart').parentNode;
      chartParent.innerHTML = '<p class="text-center text-gray-500 py-10">未選擇任何症狀，暫無法生成調理方向圖</p>';
    } else {
      // 使用requestAnimationFrame优化渲染
      requestAnimationFrame(() => {
        windowHealthChart = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: adjustmentLabels,
            datasets: [{
              label: '調理優先級得分（越低需重點調理）',
              data: adjustmentData,
              backgroundColor: 'rgba(22, 93, 255, 0.2)',
              borderColor: 'rgba(22, 93, 255, 1)',
              borderWidth: 2,
              pointBackgroundColor: 'rgba(22, 93, 255, 1)',
              pointBorderColor: '#fff',
              pointHoverBackgroundColor: '#fff',
              pointHoverBorderColor: 'rgba(22, 93, 255, 1)',
              pointRadius: 4,
              pointHoverRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              r: {
                angleLines: { display: true, color: 'rgba(0,0,0,0.1)' },
                grid: { color: 'rgba(0,0,0,0.1)' },
                pointLabels: { font: { size: 12, weight: 'bold' }, color: '#333', padding: 15 },
                ticks: { backdropColor: 'transparent', color: '#666', stepSize: 20, max: 100, min: 0 }
              }
            },
            plugins: {
              legend: { position: 'top', labels: { font: { size: 11 }, padding: 20 } },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const dir = adjustmentLabels[context.dataIndex];
                    const score = adjustmentData[context.dataIndex];
                    let tip = score < 30 ? '（急需重點調理）' : score < 60 ? '（建議加強調理）' : '（狀態良好）';
                    return `${dir}: ${score}分 ${tip}`;
                  }
                }
              },
              title: { display: true, text: '六大調理方向優先級分布', font: { size: 16, weight: 'bold' }, padding: { bottom: 20 } }
            },
            elements: { line: { tension: 0.2 } }
          }
        });
      });
    }
  }
  
  // 6. 渲染症状/习惯统计
  const symptomCountEl = document.getElementById('symptomCount');
  const habitCountEl = document.getElementById('habitCount');
  const symptomScoreBarEl = document.getElementById('symptomScoreBar');
  const habitScoreBarEl = document.getElementById('habitScoreBar');
  
  if (symptomCountEl) symptomCountEl.textContent = `${totalSymptomCount} 項症狀`;
  if (habitCountEl) habitCountEl.textContent = `${habitCount} 項不良習慣`;
  
  // 进度条宽度计算
  const symptomPercent = Math.min(100, (totalSymptomCount / 50) * 100);
  const habitPercent = Math.min(100, (habitCount / 20) * 100);
  
  if (symptomScoreBarEl) symptomScoreBarEl.style.width = `${symptomPercent}%`;
  if (habitScoreBarEl) habitScoreBarEl.style.width = `${habitPercent}%`;
  
  // 7. 渲染主要健康问题
  const mainIssuesContainer = document.getElementById('mainHealthIssues');
  let mainConcern = document.getElementById('mainConcern').value.trim();
  
  if (!mainConcern && totalSymptomCount > 0) {
    const symptomCategoryCount = countSymptomCategories();
    const topCategory = Object.entries(symptomCategoryCount).sort((a,b) => b[1]-a[1])[0]?.[0] || '全身不適';
    mainConcern = `${topCategory}（${globalUniqueSymptoms.slice(0,3).join('、')}...）`;
  } else if (!mainConcern) {
    mainConcern = '未明確說明';
  }
  
  const symptomDuration = document.getElementById('symptomDuration').value || '未說明';
  const possibleCauses = document.getElementById('possibleCauses').value || '未說明';
  const isFemale = gender === '女';
  
  // 症状分类映射
  const symptomCategories = {
    '頭部症狀': ['頭痛/頭暈', '頭部麻木/腦鳴', '嗜睡/易醒', '失眠/多夢', '偏頭痛/健忘', '言語懶散/口吃', '暈車/暈機', '頭部畏冷', '思緒中斷', '反應遲鈍', '容易打哈欠', '眉骨疼痛'],
    '眼耳鼻喉': ['老花眼', '眼睛癢/腫脹/突出/疼痛', '眼睛畏光/流淚', '眼睛乾澀/飛蚊症', '眼糞多/麥粒腫', '眼睛疲勞', '夜盲症', '視力模糊', '耳朵內潮濕/化膿', '耳垢多/耳朵疼痛/癢', '耳鳴/耳聾', '聽力減退', '鼻炎/鼻塞', '流鼻水/流鼻血', '打噴嚏', '過敏性鼻炎', '酒渣鼻', '嗅覺遲鈍', '咽喉異物感', '聲音沙啞'],
    '呼吸系統': ['咳嗽/氣喘', '支氣管炎', '感冒久不愈', '容易感冒/不易感冒', '痰液多/黃痰/痰液清稀', '白痰/黑痰/痰中帶血', '嘆氣/呼吸短促/喘氣', '打呼'],
    '循環系統': ['低血壓/高血壓', '貧血/高血脂症', '心絞痛', '心跳過快/過慢', '心悸/心律不整', '胸悶/胸痛', '右側肝區悶痛', '手足麻木/發紺', '手足發熱/冰涼/腫脹/出汗', '頭暈/頭部麻木/容易打哈欠', '面色異常（蒼白/發青）'],
    '消化系統': ['胃痛/胃酸過多/腹脹/胃部畏寒', '惡心/打嗝/噯氣', '消化不良', '食慾不佳/容易飽脹', '偏食/厭食', '食慾過盛', '腹脹/排氣多/排氣臭', '嘴唇蒼白/發青/麻木', '口苦/口乾/口臭/口中腥味', '口咸/口甜/口酸', '口臭明顯/口中辣味', '口腔潰瘍/舌潰瘍', '舌苔厚/黃苔/膩苔', '地圖舌/舌頭白斑', '舌質紫暗/舌邊齒痕', '舌頭僵硬/舌頭前端不適', '嘴唇龜裂/咽喉乾燥', '大便不成形', '便溏不盡/便秘'],
    '內分泌與代謝': ['甲狀腺機能亢進/甲狀腺機能低下', '甲狀腺結節', '肥胖/腹型肥胖', '身體消瘦', '身高矮小/發育遲緩', '體重突然增加/減少10%', '指甲半月痕缺失/稀少', '指甲易斷裂/手指倒刺', '指甲凹陷/指甲竪紋', '血管瘤/脂肪瘤', '纖維瘤/皮脂腺囊腫', '膽結石/腎結石', '扁平疣/尋常疣', '皮贅/雞眼', '淋巴結腫大', '低燒37-38℃', '手足抽搐/手足顫抖', '低血糖/高血糖', '高血脂症'],
    '肌肉骨骼與關節': ['四肢無力', '平衡能力差/容易跌倒', '手足脫皮/凍瘡', '小腿水腫', '關節疼痛/腫脹', '容易落枕/頸部僵硬', '肩膀酸脹/麻木/疼痛', '頸部疼痛/頸部畏寒', '頸部脂肪堆積', '腰部酸痛/腰部畏寒', '游離性疼痛', '脊椎僵硬/脊椎疼痛', '靜脈曲張', '容易扭傷', '腳跟疼痛'],
    '皮膚與毛髮': ['頭髮稀疏', '頭髮乾燥/掉發', '白髮/圓形禿', '頭部/面部油膩', '臉頰泛紅', '面色黃/蒼白/黝黑', '痤瘡/青春痘/色素斑', '皮膚容易瘀青/紅點', '皮膚癢/背部青春痘', '皮膚乾燥/接觸性皮炎', '銀屑病/白斑病', '黑痣增大/增多', '蜘蛛痣/魚鱗病', '各類過敏/濕疹', '產後掉發/產後憂鬱', '產後色素沈澱', '脂肪粒', '身體異味'],
    '女性症狀': ['不孕', '流產/死胎', '月經量少/月經有血塊', '月經量多/子宮肌瘤', '月經提前/延後', '月經期間煩躁/乳房脹痛', '月經期間厭食/水腫', '月經期間腰痛/頭痛', '月經期間嗜睡/失眠', '月經期間腹脹/痛經', '子宮腺肌症', '月經期間下腹部畏寒', '月經期間下腹部墜脹', '月經顏色暗/淡/深黑', '月經期間長青春痘', '月經期延長', '停經', '乳頭凹陷/乳頭溢膿', '乳房腫塊/乳腺增生', '卵巢囊腫', '子宮頸息肉', '子宮頸肥大/子宮頸囊腫', '白帶增多/白帶帶血絲', '白帶顏色偏黃/黏稠', '白帶呈稀水狀/有腥臭味'],
    '泌尿生殖系統': ['夜尿頻繁/尿頻/尿急', '尿不盡/尿失禁', '排尿疼痛/血尿', '尿分叉/排尿等待', '尿液濃稠/尿液有異味', '尿液混濁/尿液泡沫多', '尿道口灼熱感/尿道口發炎', '外陰瘙癢/外陰異味', '下腹部悶痛', '睪丸腫塊/疝氣', '肛門瘙癢', '便血/痔瘡', '脫肛/肛裂/肛瘻', '性慾降低', '自汗/多汗/盜汗', '冒冷汗/後背畏寒']
  };
  
  // 统计各分类下的症状数量
  function countSymptomCategories() {
    const count = {};
    Object.keys(symptomCategories).forEach(category => {
      count[category] = 0;
      globalUniqueSymptoms.forEach(symptom => {
        if (symptomCategories[category].includes(symptom)) count[category]++;
      });
    });
    return count;
  }
  
  // 构建分类症状HTML
  let symptomsHtml = '';
  Object.keys(symptomCategories).forEach(category => {
    if (!isFemale && category === '女性症狀') return;
    const categorySymptoms = globalUniqueSymptoms.filter(sym => symptomCategories[category].includes(sym));
    if (categorySymptoms.length > 0) {
      symptomsHtml += `<div class="mt-2">
        <p class="text-sm font-medium">${category}：</p>
        <p class="text-sm ml-4">${categorySymptoms.join('、')}</p>
      </div>`;
    }
  });
  
  // 渲染主要健康问题区域
  if (mainIssuesContainer) {
    mainIssuesContainer.style.display = 'block';
    mainIssuesContainer.innerHTML = `
      <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm">
        <h3 class="text-lg font-semibold mb-4 text-primary">主要健康問題</h3>
        <p class="mb-3"><strong>主要關注問題：</strong> ${mainConcern}</p>
        <p class="mb-3"><strong>症狀持續時間：</strong> ${symptomDuration}</p>
        <p class="mb-3"><strong>可能原因：</strong> ${possibleCauses}</p>
        ${totalSymptomCount > 0 ? 
          `<div class="mt-3"><strong>詳細症狀：</strong>${symptomsHtml}</div>` : 
          `<div class="mt-3 text-gray-500"><strong>詳細症狀：</strong>未選擇任何症狀</div>`
        }
      </div>
    `;
  } else {
    const newMainIssues = document.createElement('div');
    newMainIssues.id = 'mainHealthIssues';
    newMainIssues.className = 'main-health-issues mt-6';
    newMainIssues.innerHTML = `
      <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm">
        <h3 class="text-lg font-semibold mb-4 text-primary">主要健康問題</h3>
        <p class="mb-3"><strong>主要關注問題：</strong> ${mainConcern}</p>
        <p class="mb-3"><strong>症狀持續時間：</strong> ${symptomDuration}</p>
        <p class="mb-3"><strong>可能原因：</strong> ${possibleCauses}</p>
        ${totalSymptomCount > 0 ? 
          `<div class="mt-3"><strong>詳細症狀：</strong>${symptomsHtml}</div>` : 
          `<div class="mt-3 text-gray-500"><strong>詳細症狀：</strong>未選擇任何症狀</div>`
        }
      </div>
    `;
    
    const radarChartContainer = document.getElementById('healthBarChart')?.parentNode;
    if (radarChartContainer) {
      radarChartContainer.parentNode.insertBefore(newMainIssues, radarChartContainer.nextSibling);
    } else {
      resultSection.appendChild(newMainIssues);
    }
  }
  
  // 8. 渲染AI评估
  const aiEvaluationContainer = document.getElementById('aiEvaluation');
  if (aiEvaluationContainer) {
    if (globalUniqueSymptoms.length > 0 && globalAiComment) {
      renderAiEvaluation();
    } else {
      aiEvaluationContainer.innerHTML = `
        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100 mt-4">
          <h4 class="font-semibold text-yellow-600 mb-2 flex items-center">
            <i class="fa fa-info-circle mr-2"></i> AI評估提示
          </h4>
          <p class="text-sm text-gray-600">${globalUniqueSymptoms.length === 0 ? '未選擇症狀，無法生成AI評語' : 'AI評語未生成，請點擊下方按鈕重新生成'}</p>
          ${globalUniqueSymptoms.length > 0 ? `<button id="aiRetryBtn" class="mt-2 px-3 py-1 bg-primary text-white rounded text-sm hover:bg-primary/90">
            <i class="fa fa-refresh mr-1"></i> 重新生成AI評語
          </button>` : ''}
        </div>
      `;
      document.getElementById('aiRetryBtn')?.addEventListener('click', async () => {
        const healthData = collectHealthData();
        await callOpenAIByBackend(healthData);
      });
    }
  }
  
  // 9. 渲染健康调理建议
  const recommendationsContainer = document.getElementById('healthRecommendations');
  if (recommendationsContainer) {
    const lowScoreDirections = Object.entries(adjustmentScores)
      .filter(([_, score]) => score < 60)
      .sort((a,b) => a[1]-b[1])
      .map(([dir]) => dir);
      
    let recommendationsHtml = '';
    if (lowScoreDirections.length > 0) {
      recommendationsHtml += `<p class="text-sm font-medium text-primary mb-3">🔴 需重點調理方向：${lowScoreDirections.join('、')}</p>`;
    }
    
    recommendationsHtml += `
      <div class="health-guidance mt-4">
        <h3 class="text-lg font-semibold mb-4 text-primary">健康六大核心調理方向</h3>
        
        <!-- ① 體質——健康的「基礎土壤」 -->
        <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mb-4">
          <h4 class="font-semibold text-blue-600 mb-2">① 體質 —— 健康的「基礎土壤」</h4>
          <p class="text-sm mb-2">👉體內寒濕氣如同陰暗潮濕環境，易滋生類似水木耳（腫瘤、囊腫等）的健康問題，且會反復出現。</p>
          <p class="text-sm text-gray-700 italic">👉寓意：調體質需先排寒除濕、提升身體溫度，從根源斷掉「問題生長的溫床」。</p>
        </div>
        
        <!-- ② 免疫——身體的「常駐軍隊」 -->
        <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mb-4">
          <h4 class="font-semibold text-blue-600 mb-2">② 免疫 —— 身體的「常駐軍隊」</h4>
          <p class="text-sm mb-2">👉藥物像「臨時外援」，雖能暫時控制疾病，但會損傷免疫力；而充足營養能強化身體「常駐防線」（免疫力），使其主動抵御病邪並產生抗體。</p>
          <p class="text-sm text-gray-700 italic">👉寓意：真正的健康靠營養餵飽免疫力，而非依賴藥物。</p>
        </div>
        
        <!-- ③ 毒素——疾病反復的「隱形根源」 -->
        <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mb-4">
          <h4 class="font-semibold text-blue-600 mb-2">③ 毒素 —— 疾病反復的「隱形根源」</h4>
          <p class="text-sm mb-2">👉體內毒素如垃圾，會引發發炎、潰瘍等「蒼蠅」般的問題，若不排毒只治症狀，問題會反復甚至蔓延。</p>
          <p class="text-sm text-gray-700 italic">👉寓意：調健康第一步是打通腸道、皮膚等排毒通道，給身體「掃垃圾」。</p>
        </div>
        
        <!-- ④ 營養——身體吸收的「原料密碼」 -->
        <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mb-4">
          <h4 class="font-semibold text-blue-600 mb-2">④ 營養 —— 身體吸收的「原料密碼」</h4>
          <p class="text-sm mb-2">👉人體需「對的原料」運轉，若脾胃虛弱（如生病的牛），吃補品也難吸收，反增負擔。</p>
          <p class="text-sm text-gray-700 italic">👉寓意：補營養要先讓脾胃「有能力轉化」，再給對食物，才能變成身體能量。</p>
        </div>
        
        <!-- ⑤ 循環——健康的「暢通管道」 -->
        <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mb-4">
          <h4 class="font-semibold text-blue-600 mb-2">⑤ 循環 —— 健康的「暢通管道」</h4>
          <p class="text-sm mb-2">👉血管循環似水溝，血脂、垃圾是「雜草」，高血壓是「水流壓力大」。降壓藥僅暫時「加寬管道」，沒清垃圾問題遲早反復。</p>
          <p class="text-sm text-gray-700 italic">👉寓意：調循環關鍵是清理血管垃圾，讓血液順暢流動。</p>
        </div>
        
        <!-- ⑥ 內分泌——身體的「總調度中心」 -->
        <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm mb-4">
          <h4 class="font-semibold text-blue-600 mb-2">⑥ 內分泌 —— 身體的「總調度中心」</h4>
          <p class="text-sm mb-2">👉內分泌是身體「總電閘」，月經不調、失眠等單一問題，若沒解決內分泌失調的「總開關問題」，症狀遲早反復。</p>
          <p class="text-sm text-gray-700 italic">👉寓意：只有調整內分泌平衡，身體所有系統才能正常運轉。</p>
        </div>
      </div>
      
      <div class="mt-4 text-sm text-neutral-dark/70 text-center p-3 bg-blue-50 rounded-lg">
        六大調理邏輯：<br>體質是根基，循環是動力，<br>毒素要清除，免疫要增強，<br>營養要均衡，內分泌要穩定，<br>才能長久健康！
      </div>
    `;
    
    recommendationsContainer.innerHTML = recommendationsHtml;
  }
}

// 截图与分享功能
async function handleImageDownload() {
  try {
    // 禁用按钮并显示加载状态
    const downloadReportBtn = document.getElementById('downloadReportBtn');
    if (downloadReportBtn) {
      downloadReportBtn.disabled = true;
      downloadReportBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 準備中...';
    }
    
    // 创建进度提示
    const progressIndicator = createProgressIndicator();
    document.body.appendChild(progressIndicator);
    
    // 1. 依赖检查
    if (typeof html2canvas === 'undefined') throw new Error('圖片處理庫未加載，請刷新頁面重試');
    const resultSection = document.getElementById('result');
    if (!resultSection) throw new Error('未找到健康評估結果頁容器，請先提交評估');
    
    updateProgress(progressIndicator, 20, '調整頁面樣式...');
    
    // 2. 临时调整样式
    const originalStyles = {
      resultPadding: resultSection.style.padding,
      resultMargin: resultSection.style.margin,
      resultBoxShadow: resultSection.style.boxShadow,
      position: resultSection.style.position,
      top: resultSection.style.top,
      left: resultSection.style.left,
      zIndex: resultSection.style.zIndex
    };
    
    resultSection.style.padding = '20px';
    resultSection.style.margin = '0 auto';
    resultSection.style.boxShadow = 'none';
    
    const rect = resultSection.getBoundingClientRect();
    resultSection.style.position = 'relative';
    resultSection.style.top = `-${rect.top}px`;
    resultSection.style.left = `-${rect.left}px`;
    resultSection.style.zIndex = '1000';
    
    // 临时隐藏六大调理方向
    const healthRecommendations = document.getElementById('healthRecommendations');
    const originalHealthRecommendationsDisplay = healthRecommendations ? healthRecommendations.style.display : 'block';
    if (healthRecommendations) {
      healthRecommendations.style.display = 'none';
    }
    
    // 额外隐藏可能包含六大调理方向的其他元素
    const healthGuidance = document.querySelector('.health-guidance');
    const originalHealthGuidanceDisplay = healthGuidance ? healthGuidance.style.display : 'block';
    if (healthGuidance) {
      healthGuidance.style.display = 'none';
    }
    
    updateProgress(progressIndicator, 40, '準備截圖...');
    
    // 3. 执行截图
    const canvas = await html2canvas(resultSection, {
      useCORS: true,
      allowTaint: false,
      scale: Math.min(window.devicePixelRatio || 2, 2),
      logging: false,
      scrollX: 0,
      scrollY: 0,
      windowWidth: resultSection.scrollWidth,
      windowHeight: resultSection.scrollHeight,
      ignoreElements: (el) => {
        // 明确排除不需要的元素
        return el.id === 'downloadReportBtn' || 
               el.id === 'singleShareBtn' || 
               el.id === 'restartBtn' || 
               el === progressIndicator || 
               el.id === 'healthRecommendations' ||
               el.classList.contains('health-guidance');
      }
    });
    
    updateProgress(progressIndicator, 60, '處理圖片...');
    
    // 4. 恢复原始样式
    Object.keys(originalStyles).forEach(key => {
      resultSection.style[key] = originalStyles[key];
    });
    
    // 恢复六大调理方向显示
    if (healthRecommendations) {
      healthRecommendations.style.display = originalHealthRecommendationsDisplay;
    }
    if (healthGuidance) {
      healthGuidance.style.display = originalHealthGuidanceDisplay;
    }
    
    // 5. 图片处理
    const userName = document.getElementById('name').value.trim() || '未知用戶';
    const currentDate = new Date();
    const formattedDate = `${currentDate.getFullYear()}年${String(currentDate.getMonth() + 1).padStart(2, '0')}月${String(currentDate.getDate()).padStart(2, '0')}日`;
    localImageName = `${userName}_健康評估結果_${formattedDate}.jpg`;
    
    // 转换Canvas为JPG Blob
    localImageBlob = await new Promise((resolve, reject) => {
      canvas.toBlob(blob => blob ? resolve(blob) : reject(new Error('圖片Blob生成失敗')), 'image/jpeg', 0.8);
    });
    
    updateProgress(progressIndicator, 75, '轉檔中...');
    
    // 6. 并行处理本地保存和ImgBB上传
    const [saveResult, uploadResult] = await Promise.allSettled([
      saveToGallery(localImageBlob, localImageName),
      uploadToImgBB(localImageBlob, localImageName)
    ]);
    
    // 处理上传结果
    if (uploadResult.status === 'fulfilled' && uploadResult.value) {
      imgbbImageUrl = uploadResult.value.url;
      imgbbDeleteUrl = uploadResult.value.deleteUrl;
      // 异步更新Google Sheets
      submitToGoogleSheets().catch(err => console.log('更新圖片URL失敗:', err));
    } else if (uploadResult.status === 'rejected') {
      // 显示上传错误但不中断流程
      console.warn('圖片上傳失敗:', uploadResult.reason);
      showToast('圖片已保存到本地，但上傳至服務器失敗', 'error');
    }
    
    // 检查保存结果
    if (saveResult.status === 'rejected') {
      throw new Error(`保存圖片失敗: ${saveResult.reason.message}`);
    }
    
    updateProgress(progressIndicator, 90, '保存圖片...');
    
    // 7. 完成处理
    document.body.removeChild(progressIndicator);
    
    if (downloadReportBtn) {
      downloadReportBtn.disabled = false;
      downloadReportBtn.innerHTML = '<i class="fa fa-download mr-2"></i> 重新轉檔操作';
    }
    
    showToast(`圖片已成功保存！\n文件名：${localImageName}`);
    showSingleShareButton(userName, formattedDate);
  } catch (error) {
    console.error('圖片處理失敗：', error);
    const progressIndicator = document.getElementById('progressIndicator');
    if (progressIndicator) document.body.removeChild(progressIndicator);
    
    const downloadReportBtn = document.getElementById('downloadReportBtn');
    if (downloadReportBtn) {
      downloadReportBtn.disabled = false;
      downloadReportBtn.innerHTML = '<i class="fa fa-download mr-2"></i> 下載圖片';
    }
    
    showToast(`操作失敗：${error.message}`, 'error');
  }
}

// 单独的ImgBB上传函数
async function uploadToImgBB(blob, fileName) {
  try {
    const base64Image = await new Promise((resolve) => {
      const reader = new FileReader();
      reader.onloadend = () => resolve(reader.result.split(',')[1]);
      reader.readAsDataURL(blob);
    });
    
    const formData = new FormData();
    formData.append('key', IMGBB_API_KEY);
    formData.append('image', base64Image);
    formData.append('name', fileName);
    
    // 超时控制
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), REQUEST_TIMEOUT);
    
    const uploadResponse = await fetch(IMGBB_UPLOAD_URL, {
      method: 'POST',
      body: formData,
      signal: controller.signal
    });
    
    clearTimeout(timeoutId);
    
    if (!uploadResponse.ok) {
      throw new Error(`HTTP錯誤: ${uploadResponse.status}`);
    }
    
    const uploadResult = await uploadResponse.json();
    if (!uploadResult.success) {
      throw new Error(`上傳失敗：${uploadResult?.error?.message || '未知錯誤'}`);
    }
    
    return {
      url: uploadResult.data.url,
      deleteUrl: uploadResult.data.delete_url
    };
  } catch (error) {
    console.warn('ImgBB上傳失敗:', error);
    // 不阻断主流程，仅返回错误
    throw error;
  }
}

// 创建进度指示器
function createProgressIndicator() {
  const indicator = document.createElement('div');
  indicator.id = 'progressIndicator';
  indicator.style.cssText = `
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 12px;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15); z-index: 99999;
    display: flex; flex-direction: column; align-items: center; min-width: 280px;
  `;
  
  // 进度条容器
  const progressContainer = document.createElement('div');
  progressContainer.style.cssText = `
    width: 100%; height: 6px; background: #f0f0f0; border-radius: 3px; margin: 15px 0;
    overflow: hidden;
  `;
  
  // 进度条
  const progressBar = document.createElement('div');
  progressBar.id = 'progressBar';
  progressBar.style.cssText = `
    height: 100%; background: #165DFF; width: 0%; transition: width 0.3s ease;
  `;
  
  progressContainer.appendChild(progressBar);
  
  // 状态文本
  const statusText = document.createElement('div');
  statusText.id = 'progressStatus';
  statusText.style.cssText = `
    color: #333; font-size: 15px; text-align: center; margin-top: 10px;
  `;
  statusText.textContent = '準備中...';
  
  // 加载动画
  const spinner = document.createElement('i');
  spinner.className = 'fa fa-circle-o-notch fa-spin';
  spinner.style.cssText = 'font-size: 30px; color: #165DFF;';
  
  indicator.appendChild(spinner);
  indicator.appendChild(progressContainer);
  indicator.appendChild(statusText);
  
  return indicator;
}

// 更新进度
function updateProgress(indicator, percent, text) {
  indicator.querySelector('#progressBar').style.width = `${percent}%`;
  indicator.querySelector('#progressStatus').textContent = text;
}

// 保存图片到相册
function saveToGallery(blob, fileName) {
  // iPad特殊处理
  if (isIOS) {
    return new Promise((resolve) => {
      const blobUrl = URL.createObjectURL(blob);
      const downloadLink = document.createElement('a');
      downloadLink.download = fileName;
      downloadLink.href = blobUrl;
      downloadLink.style.display = 'none';
      downloadLink.target = '_blank';
      document.body.appendChild(downloadLink);
      
      // 模拟点击触发下载
      const clickEvent = new MouseEvent('click', {
        view: window,
        bubbles: true,
        cancelable: true
      });
      downloadLink.dispatchEvent(clickEvent);
      
      // 清理临时资源
      setTimeout(() => {
        document.body.removeChild(downloadLink);
        URL.revokeObjectURL(blobUrl);
        resolve(true);
      }, 1000);
    });
  }
  
  return new Promise((resolve, reject) => {
    if (window.showSaveFilePicker) {
      window.showSaveFilePicker({
        suggestedName: fileName,
        types: [{ description: '圖片文件', accept: { 'image/jpeg': ['.jpg'] } }]
      })
      .then(handle => handle.createWritable())
      .then(writable => writable.write(blob).then(() => writable.close()))
      .then(() => resolve(true))
      .catch(err => saveWithAnchorTag(blob, fileName, resolve, reject));
    } else {
      saveWithAnchorTag(blob, fileName, resolve, reject);
    }
  });
}

// a标签兼容下载
function saveWithAnchorTag(blob, fileName, resolve, reject) {
  const blobUrl = URL.createObjectURL(blob);
  const downloadLink = document.createElement('a');
  downloadLink.download = fileName;
  downloadLink.href = blobUrl;
  downloadLink.style.display = 'none';
  document.body.appendChild(downloadLink);
  
  requestAnimationFrame(() => {
    downloadLink.click();
    
    // 清理临时资源
    setTimeout(() => {
      document.body.removeChild(downloadLink);
      URL.revokeObjectURL(blobUrl);
      resolve(true);
    }, 1000);
  });
}

// 显示分享按钮
function showSingleShareButton(userName, date) {
  // 移除旧的分享按钮
  const existingShareBtn = document.getElementById('singleShareBtn');
  if (existingShareBtn) document.body.removeChild(existingShareBtn);
  
  // 创建新的分享按钮
  const shareBtn = document.createElement('button');
  shareBtn.id = 'singleShareBtn';
  shareBtn.style.cssText = `
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    padding: 12px 28px; border-radius: 30px; background: #165DFF; color: white;
    border: none; box-shadow: 0 4px 15px rgba(22, 93, 255, 0.3);
    font-size: 16px; font-weight: bold; display: flex; align-items: center; gap: 8px;
    z-index: 9999; cursor: pointer; transition: background 0.2s ease;
  `;
  shareBtn.innerHTML = '<i class="fa fa-share-alt"></i> 分享健康自檢表';
  document.body.appendChild(shareBtn);
  
  // 添加悬停效果
  shareBtn.addEventListener('mouseover', () => {
    shareBtn.style.background = '#0E42D2';
  });
  
  shareBtn.addEventListener('mouseout', () => {
    shareBtn.style.background = '#165DFF';
  });
  
  // 绑定分享事件
  shareBtn.addEventListener('click', async () => {
    try {
      // 增强的检查和错误处理
      if (!localImageBlob && !imgbbImageUrl) {
        showToast('分享資源不完整，請重新生成圖片', 'error');
        return;
      }
      
      // 若localImageBlob不存在但有imgbbImageUrl，仍然允许分享
      if (!localImageBlob) {
        showToast('使用網絡圖片進行分享', 'info');
      }
      
      // 构建分享内容
      let imageFile = null;
      if (localImageBlob) {
        imageFile = new File([localImageBlob], localImageName, { type: 'image/jpeg' });
      }
      
      const shareText = `📋 『 ${userName} 』的健康自檢表\n🗓️ 自檢日期：${date}\n💡 包含：調理方向 + AI評估\n🔗 圖片鏈接：`;
      const shareUrl = imgbbImageUrl || '';
      
      // iPad分享特殊处理
      if (isIOS) {
        if (navigator.share) {
          shareBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 喚醒分享...';
          
          // 对iPad Safari使用不同的分享策略
          const shareData = {
            title: `${userName}的健康自檢表`,
            text: shareText + (shareUrl ? shareUrl : ''),
            url: shareUrl || window.location.href
          };
          
          // 如果有图片文件且支持文件分享，才添加文件
          if (imageFile && navigator.canShare && navigator.canShare({ files: [imageFile] })) {
            shareData.files = [imageFile];
          }
          
          await navigator.share(shareData);
          showToast('分享成功！');
          shareBtn.innerHTML = '<i class="fa fa-share-alt"></i> 分享健康自檢表';
        } else {
          // Safari不支持分享API时，复制链接
          await navigator.clipboard.writeText(shareText + (shareUrl || window.location.href));
          showToast('分享鏈接已複製到剪貼板');
        }
      } else if (navigator.share) {
        // 其他设备的分享逻辑
        shareBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> 喚醒分享...';
        
        const shareData = {
          title: `${userName}的健康自檢表`,
          text: shareText,
          url: shareUrl || window.location.href
        };
        
        if (imageFile && navigator.canShare && navigator.canShare({ files: [imageFile] })) {
          shareData.files = [imageFile];
        }
        
        await navigator.share(shareData);
        showToast('分享成功！');
        shareBtn.innerHTML = '<i class="fa fa-share-alt"></i> 分享健康自檢表';
      } else {
        // 不支持分享API时，复制链接
        await navigator.clipboard.writeText(shareText + (shareUrl || window.location.href));
        showToast('分享內容已複製到剪貼板');
      }
    } catch (shareError) {
      console.error('分享失敗:', shareError);
      shareBtn.innerHTML = '<i class="fa fa-share-alt"></i> 分享健康自檢表';
      if (shareError.name !== 'AbortError') {
        showToast(`分享失敗，鏈接：${imgbbImageUrl || '無'}`, 'error');
      } else {
        showToast('分享已取消');
      }
    }
  });
}

// 初始化函数 - 仅在DOM完全加载后执行
document.addEventListener('DOMContentLoaded', function() {
  // 启动应用程序初始化
  initApp();
});

</script>






    
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>LIFF 訊息回傳</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>請輸入您的訊息：</h2>
  <input type="text" id="userMessage" placeholder="輸入訊息" style="width: 300px;">
  <button onclick="sendMessage()">送出</button>

  <p id="status"></p>

  <script>
    const liffId = '2007488640-MVdW20Xe'; // 替換成你自己的 LIFF ID
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbyUqLr2uf_gAqzjc_SCOK3fFmqqLE4vrhmkjchBgRxomzaAYPME6DhE4tdIxbiMuhafpA/exec'; // 例如：https://script.google.com/macros/s/xxxxx/exec

    async function initializeLiff() {
      await liff.init({ liffId });

      if (!liff.isLoggedIn()) {
        liff.login();
      }

      const profile = await liff.getProfile();
      const userId = profile.userId;
      const displayName = profile.displayName;

      window.liffUser = {
        userId,
        displayName
      };
    }

    async function sendMessage() {
      const message = document.getElementById('userMessage').value.trim();
      if (!message) {
        document.getElementById('status').textContent = "請輸入訊息";
        return;
      }

      const data = {
        userId: window.liffUser.userId,
        displayName: window.liffUser.displayName,
        message: message,
        replyMessage: "謝謝您的留言，我們會盡快回覆您！"
      };

      try {
        const res = await fetch(scriptUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        const text = await res.text();
        document.getElementById('status').textContent = `送出成功：${text}`;
        document.getElementById('userMessage').value = '';
      } catch (err) {
        document.getElementById('status').textContent = "送出失敗：" + err;
      }
    }

    initializeLiff();
  </script>
</body>
</html>

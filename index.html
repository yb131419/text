<!DOCTYPE html>
<html>
<head>
  <title>LIFF App</title>
  <script src="https://static.line-scdn.net/liff/edge/2.1/liff.js"></script>
</head>
<body>
  <h1>LIFF App</h1>
  <button id="sendMessageButton">開啟 LIFF</button>
  <script>
    document.getElementById('sendMessageButton').addEventListener('click', function() {
      liff.sendMessages([
        {
          type: 'text',
          text: 'LIFF 開啟'
        }
      ])
      .then(function() {
        window.alert('訊息已送出！');
        liff.closeWindow();
      })
      .catch(function(error) {
        window.alert('訊息送出失敗: ' + error);
      });
    });

    liff.init({ liffId: '2007488640-MVdW20Xe' })
      .then(() => {
        const userId = liff.getUserId();
        const displayName = liff.getProfile().then(profile => {
          return profile.displayName;
        });

        // 發送 LIFF 事件到後端
        fetch('https://script.google.com/macros/s/AKfycbyUqLr2uf_gAqzjc_SCOK3fFmqqLE4vrhmkjchBgRxomzaAYPME6DhE4tdIxbiMuhafpA/exec', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            event: {
              userId: userId,
              displayName: displayName,
              liffId: liff.getId(),
              message: 'LIFF 開啟'
            }
          })
        })
        .then(response => response.json())
        .then(data => {
          console.log(data.message);
        })
        .catch(error => {
          console.error('Error:', error);
        });
      })
      .catch((err) => {
        console.error('LIFF 初始化失敗', err);
      });
  </script>
</body>
</html>
